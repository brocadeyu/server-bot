"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["3133"],{59816:function(e,n,i){i.r(n),i.d(n,{default:function(){return c}});var s=i(55367),r=i(26971),l=i(28855),a=i(38146);function d(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",h3:"h3",code:"code",pre:"pre",ul:"ul",li:"li",strong:"strong",h4:"h4",div:"div",h5:"h5",ol:"ol"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"babel-plugin",children:["Babel Plugin",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#babel-plugin",children:"#"})]}),"\n","\n",(0,s.jsx)(l.ZB,{href:"https://github.com/web-infra-dev/rsbuild/tree/main/packages/plugin-babel"}),"\n",(0,s.jsx)(n.p,{children:"Rsbuild uses SWC transpilation by default. When existing functions cannot meet the requirements, and some Babel presets or plugins need to be added for additional processing, you can use Rsbuild's Babel Plugin."}),"\n",(0,s.jsxs)(n.h2,{id:"quick-start",children:["Quick Start",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#quick-start",children:"#"})]}),"\n",(0,s.jsxs)(n.h3,{id:"install-plugin",children:["Install Plugin",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#install-plugin",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"You can install the plugin using the following command:"}),"\n","\n",(0,s.jsx)(a.PackageManagerTabs,{command:"add @rsbuild/plugin-babel -D"}),"\n",(0,s.jsxs)(n.h3,{id:"register-plugin",children:["Register Plugin",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#register-plugin",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["You can register the plugin in the ",(0,s.jsx)(n.code,{children:"rsbuild.config.ts"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"import { pluginBabel } from '@rsbuild/plugin-babel';\n\nexport default {\n  plugins: [pluginBabel()],\n};\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"compilation-cache",children:["Compilation Cache",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#compilation-cache",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"After using the Babel plugin, Rsbuild will perform the Babel transpilation in addition to the standard SWC transpilation, which adds additional compilation overhead. This can cause a noticeable decrease in build speed."}),"\n",(0,s.jsxs)(n.p,{children:["To reduce the overhead of Babel transpilation, the ",(0,s.jsx)(n.code,{children:"@rsbuild/plugin-babel"})," enables Babel compilation cache by default. If you want to disable the cache, you can set ",(0,s.jsx)(n.code,{children:"performance.buildCache"})," to ",(0,s.jsx)(n.code,{children:"false"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"export default {\n  performance: {\n    buildCache: false,\n  },\n};\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"options",children:["Options",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#options",children:"#"})]}),"\n",(0,s.jsxs)(n.h3,{id:"babelloaderoptions",children:["babelLoaderOptions",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#babelloaderoptions",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["Options passed to ",(0,s.jsx)(n.code,{children:"babel-loader"}),", please refer to the ",(0,s.jsx)(n.a,{href:"https://github.com/babel/babel-loader",target:"_blank",rel:"noopener noreferrer",children:"babel-loader documentation"})," for detailed usage."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"Object | Function"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Default:"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const defaultOptions = {\n  babelrc: false,\n  compact: false,\n  configFile: false,\n  plugins: [\n    ['@babel/plugin-proposal-decorators', config.source.decorators],\n    ...(isLegacyDecorators ? ['@babel/plugin-transform-class-properties'] : []),\n  ],\n  presets: [\n    [\n      '@babel/preset-typescript',\n      {\n        allExtensions: true,\n        allowDeclareFields: true,\n        allowNamespaces: true,\n        isTSX: true,\n        optimizeConstEnums: true,\n      },\n    ],\n  ],\n};\n"})}),"\n",(0,s.jsxs)(n.h4,{id:"function-type",children:["Function Type",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#function-type",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["When configuration is of type ",(0,s.jsx)(n.code,{children:"Function"}),", the default Babel configuration will be passed as the first parameter. You can directly modify the configuration object or return an object as the final ",(0,s.jsx)(n.code,{children:"babel-loader"})," configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: (config) => {\n    // Add a Babel plugin\n    // note: the plugin have been added to the default config to support antd load on demand\n    config.plugins ||= [];\n    config.plugins.push([\n      'babel-plugin-import',\n      {\n        libraryName: 'my-components',\n        libraryDirectory: 'es',\n        style: true,\n      },\n    ]);\n  },\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"The second parameter of the function provides some more convenient utility functions. Please continue reading the documentation below."}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive tip",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"TIP"}),(0,s.jsx)(n.div,{className:"rspress-directive-content",children:(0,s.jsxs)(n.p,{children:["The above example is just for reference, usually you don't need to manually configure ",(0,s.jsx)(n.code,{children:"babel-plugin-import"}),", because the Rsbuild already provides a more general ",(0,s.jsx)(n.code,{children:"source.transformImport"})," configuration.\n"]})})]}),"\n",(0,s.jsxs)(n.h4,{id:"object-type",children:["Object Type",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#object-type",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["When configuration's type is ",(0,s.jsx)(n.code,{children:"Object"}),", the config will be shallow merged with default config by ",(0,s.jsx)(n.code,{children:"Object.assign"}),"."]}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive caution",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"CAUTION"}),(0,s.jsx)(n.div,{className:"rspress-directive-content",children:(0,s.jsxs)(n.p,{children:["Note that ",(0,s.jsx)(n.code,{children:"Object.assign"})," is a shallow copy and will completely overwrite the built-in ",(0,s.jsx)(n.code,{children:"presets"})," or ",(0,s.jsx)(n.code,{children:"plugins"})," array, please use it with caution.\n"]})})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: {\n    plugins: [\n      [\n        'babel-plugin-import',\n        {\n          libraryName: 'my-components',\n          libraryDirectory: 'es',\n          style: true,\n        },\n      ],\n    ],\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.h4,{id:"util-functions",children:["Util Functions",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#util-functions",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"When configuration is a Function, the tool functions available for the second parameter are as follows:"}),"\n",(0,s.jsxs)(n.h5,{id:"addplugins",children:["addPlugins",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#addplugins",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"(plugins: BabelPlugin[]) => void"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Add some Babel plugins. For example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: (config, { addPlugins }) => {\n    addPlugins([\n      [\n        'babel-plugin-import',\n        {\n          libraryName: 'my-components',\n          libraryDirectory: 'es',\n          style: true,\n        },\n      ],\n    ]);\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.h5,{id:"addpresets",children:["addPresets",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#addpresets",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"(presets: BabelPlugin[]) => void"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Add Babel preset configuration. (No need to add presets in most cases)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: (config, { addPresets }) => {\n    addPresets(['@babel/preset-env']);\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.h5,{id:"removeplugins",children:["removePlugins",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#removeplugins",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"(plugins: string | string[]) => void"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To remove the Babel plugin, just pass in the name of the plugin to be removed, you can pass in a single string or an array of strings."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: (config, { removePlugins }) => {\n    removePlugins('babel-plugin-import');\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.h5,{id:"removepresets",children:["removePresets",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#removepresets",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"(presets: string | string[]) => void"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To remove the Babel preset configuration, pass in the name of the preset to be removed, you can pass in a single string or an array of strings."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  babelLoaderOptions: (config, { removePresets }) => {\n    removePresets('@babel/preset-env');\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"include",children:["include",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#include",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"string | RegExp | (string | RegExp)[]"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Default:"})," ",(0,s.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Used to specify the files that need to be compiled by Babel."}),"\n",(0,s.jsxs)(n.p,{children:["Due to the performance overhead of Babel compilation, matching only certain files through ",(0,s.jsx)(n.code,{children:"include"})," can reduce the number of modules compiled by Babel, thereby improving build performance."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, to only compile ",(0,s.jsx)(n.code,{children:".custom.js"})," files and ignore files under ",(0,s.jsx)(n.code,{children:"node_modules"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pluginBabel({\n  include: /\\.custom\\.js$/,\n  // recommended to exclude the node_modules to improve build performance\n  exclude: /[\\\\/]node_modules[\\\\/]/,\n});\n"})}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive tip",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"TIP"}),(0,s.jsxs)(n.div,{className:"rspress-directive-content",children:[(0,s.jsxs)(n.p,{children:["When you configure the ",(0,s.jsx)(n.code,{children:"include"})," or ",(0,s.jsx)(n.code,{children:"exclude"})," options, Rsbuild will create a separate Rspack rule to apply babel-loader and swc-loader."]}),"\n",(0,s.jsxs)(n.p,{children:["This separate rule is completely independent of the SWC rule built into Rsbuild and is not affected by ",(0,s.jsx)(n.a,{href:"/config/source/include",children:"source.include"})," and ",(0,s.jsx)(n.a,{href:"/config/source/exclude",children:"source.exclude"}),".\n"]})]})]}),"\n",(0,s.jsxs)(n.h3,{id:"exclude",children:["exclude",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#exclude",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"string | RegExp | (string | RegExp)[]"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Default:"})," ",(0,s.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Used to specify the files that do not need to be compiled by Babel."}),"\n",(0,s.jsxs)(n.p,{children:["Due to the performance overhead of Babel compilation, excluding certain files through ",(0,s.jsx)(n.code,{children:"exclude"})," can reduce the number of modules compiled by Babel, thereby improving build performance."]}),"\n",(0,s.jsxs)(n.h2,{id:"debugging-configs",children:["Debugging Configs",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#debugging-configs",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["After modifying the ",(0,s.jsx)(n.code,{children:"babel-loader"})," configuration, you can view the final generated configuration in ",(0,s.jsx)(n.a,{href:"/guide/debug/debug-mode",children:"Rsbuild debug mode"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["First, enable debug mode by using the ",(0,s.jsx)(n.code,{children:"DEBUG=rsbuild"})," option:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Debug development mode\nDEBUG=rsbuild pnpm dev\n\n# Debug production mode\nDEBUG=rsbuild pnpm build\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then open the generated ",(0,s.jsx)(n.code,{children:"rspack.config.web.mjs"})," file and search for the ",(0,s.jsx)(n.code,{children:"babel-loader"})," keyword to see the complete ",(0,s.jsx)(n.code,{children:"babel-loader"})," configuration."]}),"\n",(0,s.jsxs)(n.h2,{id:"faq",children:["FAQ",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#faq",children:"#"})]}),"\n",(0,s.jsxs)(n.h3,{id:"compilation-freezes",children:["Compilation Freezes",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#compilation-freezes",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"After using the babel plugin, if the compilation progress bar is stuck, but there is no Error log on the terminal, it is usually because an exception occurred during the compilation. In some cases, when Error is caught by webpack or other modules, the error log can not be output correctly. The most common scenario is that there is an exception in the Babel config, which is caught by webpack, and webpack swallows the Error in some cases."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.p,{children:"If this problem occurs after you modify the Babel config, it is recommended to check for the following incorrect usages:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"You have configured a plugin or preset that does not exist, maybe the name is misspelled, or it is not installed correctly."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// wrong example\npluginBabel({\n  babelLoaderOptions: (config, { addPlugins }) => {\n    // The plugin has the wrong name or is not installed\n    addPlugins('babel-plugin-not-exists');\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Whether multiple babel-plugin-imports are configured, but the name of each babel-plugin-import is not declared in the third item of the array."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// wrong example\npluginBabel({\n  babelLoaderOptions: (config, { addPlugins }) => {\n    addPlugins([\n      ['babel-plugin-import', { libraryName: 'antd', libraryDirectory: 'es' }],\n      [\n        'babel-plugin-import',\n        { libraryName: 'antd-mobile', libraryDirectory: 'es' },\n      ],\n    ]);\n  },\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// correct example\npluginBabel({\n  babelLoaderOptions: (config, { addPlugins }) => {\n    addPlugins([\n      [\n        'babel-plugin-import',\n        { libraryName: 'antd', libraryDirectory: 'es' },\n        'antd',\n      ],\n      [\n        'babel-plugin-import',\n        { libraryName: 'antd-mobile', libraryDirectory: 'es' },\n        'antd-mobile',\n      ],\n    ]);\n  },\n});\n"})})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}let c=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["en%2Fplugins%2Flist%2Fplugin-babel.mdx"]={toc:[{text:"Quick Start",id:"quick-start",depth:2},{text:"Install Plugin",id:"install-plugin",depth:3},{text:"Register Plugin",id:"register-plugin",depth:3},{text:"Compilation Cache",id:"compilation-cache",depth:2},{text:"Options",id:"options",depth:2},{text:"babelLoaderOptions",id:"babelloaderoptions",depth:3},{text:"Function Type",id:"function-type",depth:4},{text:"Object Type",id:"object-type",depth:4},{text:"Util Functions",id:"util-functions",depth:4},{text:"include",id:"include",depth:3},{text:"exclude",id:"exclude",depth:3},{text:"Debugging Configs",id:"debugging-configs",depth:2},{text:"FAQ",id:"faq",depth:2},{text:"Compilation Freezes",id:"compilation-freezes",depth:3}],title:"Babel Plugin",frontmatter:{}}}}]);