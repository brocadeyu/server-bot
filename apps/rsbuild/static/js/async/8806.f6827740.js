"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["8806"],{65545:function(e,n,r){r.r(n),r.d(n,{default:function(){return a}});var t=r(55367),s=r(26971);function o(e){let n=Object.assign({h1:"h1",a:"a",ul:"ul",li:"li",strong:"strong",code:"code",p:"p",h2:"h2",h3:"h3",pre:"pre"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"serverproxy",children:["server.proxy",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#serverproxy",children:"#"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Type:"})," ",(0,t.jsx)(n.code,{children:"Record<string, string> | Record<string, ProxyOptions> | ProxyOptions[] | ProxyOptions"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Default:"})," ",(0,t.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configure proxy rules for the dev server or preview server to proxy requests to the specified service."}),"\n",(0,t.jsxs)(n.h2,{id:"example",children:["Example",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example",children:"#"})]}),"\n",(0,t.jsxs)(n.h3,{id:"basic-usage",children:["Basic Usage",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#basic-usage",children:"#"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  server: {\n    proxy: {\n      // http://localhost:3000/api -> http://localhost:3000/api\n      // http://localhost:3000/api/foo -> http://localhost:3000/api/foo\n      '/api': 'http://localhost:3000',\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["A request to ",(0,t.jsx)(n.code,{children:"/api/users"})," will now proxy the request to ",(0,t.jsx)(n.a,{href:"http://localhost:3000/api/users",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/api/users"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can also proxy to an online domain name, such as:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  server: {\n    proxy: {\n      // http://localhost:3000/api -> https://nodejs.org/api\n      // http://localhost:3000/api/foo -> https://nodejs.org/api/foo\n      '/api': 'https://nodejs.org',\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"path-rewrite",children:["Path Rewrite",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#path-rewrite",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["If you don't want ",(0,t.jsx)(n.code,{children:"/api"})," to be passed along, we need to rewrite the path:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  server: {\n    proxy: {\n      // http://localhost:3000/api -> http://localhost:3000\n      // http://localhost:3000/api/foo -> http://localhost:3000/foo\n      '/api': {\n        target: 'http://localhost:3000',\n        pathRewrite: { '^/api': '' },\n      },\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"proxy-websocket",children:["Proxy WebSocket",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#proxy-websocket",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["If you want to proxy WebSocket requests, you can enable it through set ",(0,t.jsx)(n.code,{children:"ws"})," to ",(0,t.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  server: {\n    proxy: {\n      '/rsbuild-hmr': {\n        target: 'http://localhost:3000', // will proxy to ws://localhost:3000/rsbuild-hmr\n        ws: true,\n      },\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"options",children:["Options",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#options",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["The Rsbuild server proxy makes use of the ",(0,t.jsx)(n.a,{href:"https://github.com/chimurai/http-proxy-middleware/tree/2.x",target:"_blank",rel:"noopener noreferrer",children:"http-proxy-middleware"})," package. Check out its documentation for more advanced usages."]}),"\n",(0,t.jsx)(n.p,{children:"The full type definition of Rsbuild server proxy is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import type { Options as HttpProxyOptions } from 'http-proxy-middleware';\n\ntype Filter = string | string[] | ((pathname: string, req: Request) => boolean);\n\ntype ProxyOptions = HttpProxyOptions & {\n  bypass?: (\n    req: IncomingMessage,\n    res: ServerResponse,\n    proxyOptions: ProxyOptions,\n  ) => string | undefined | null | boolean;\n  context?: Filter;\n};\n\ntype ProxyConfig =\n  | ProxyOptions\n  | ProxyOptions[]\n  | Record<string, string>\n  | Record<string, ProxyOptions>;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In addition to the ",(0,t.jsx)(n.code,{children:"http-proxy-middleware"})," option, Rsbuild also support the ",(0,t.jsx)(n.code,{children:"bypass"})," and ",(0,t.jsx)(n.code,{children:"context"})," options."]}),"\n",(0,t.jsxs)(n.h3,{id:"bypass",children:["bypass",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#bypass",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Bypass the proxy based on the return value of a function."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"null"})," or ",(0,t.jsx)(n.code,{children:"undefined"})," to continue processing the request with proxy."]}),"\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"true"})," to continue processing the request without proxy."]}),"\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"false"})," to produce a 404 error for the request."]}),"\n",(0,t.jsx)(n.li,{children:"Return a path to serve from, instead of continuing to proxy the request."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// custom bypass\nexport default {\n  server: {\n    proxy: {\n      '/api': {\n        target: 'http://localhost:3000',\n        bypass: function (req, res, proxyOptions) {\n          if (req.headers.accept.indexOf('html') !== -1) {\n            console.log('Skipping proxy for browser request.');\n            return '/index.html';\n          }\n        },\n      },\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"context",children:["context",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#context",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Used to proxy multiple specified paths to the same target."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  server: {\n    proxy: [\n      {\n        context: ['/auth', '/api'],\n        target: 'http://localhost:3000',\n      },\n    ],\n  },\n};\n"})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}let a=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["en%2Fconfig%2Fserver%2Fproxy.mdx"]={toc:[{text:"Example",id:"example",depth:2},{text:"Basic Usage",id:"basic-usage",depth:3},{text:"Path Rewrite",id:"path-rewrite",depth:3},{text:"Proxy WebSocket",id:"proxy-websocket",depth:3},{text:"Options",id:"options",depth:2},{text:"bypass",id:"bypass",depth:3},{text:"context",id:"context",depth:3}],title:"server.proxy",frontmatter:{}}}}]);