"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["6015"],{12815:function(e,n,r){r.r(n),r.d(n,{default:function(){return d}});var t=r(55367),s=r(26971);function i(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",ul:"ul",li:"li"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"server-side-rendering-ssr",children:["Server-Side Rendering (SSR)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#server-side-rendering-ssr",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"This chapter introduces how to implement SSR functionality using Rsbuild."}),"\n",(0,t.jsxs)(n.p,{children:["Please note that Rsbuild itself does not provide out-of-the-box SSR functionality, but instead provides low-level APIs and configurations to allow framework developers to implement SSR. If you require out-of-the-box SSR support, you may consider using full-stack frameworks based on Rsbuild, such as ",(0,t.jsx)(n.a,{href:"https://github.com/web-infra-dev/modern.js",target:"_blank",rel:"noopener noreferrer",children:"Modern.js"}),"."]}),"\n",(0,t.jsxs)(n.h2,{id:"what-is-ssr",children:["What is SSR",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#what-is-ssr",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:'SSR stands for "Server-Side Rendering". It means that the HTML of the web page is generated by the server and sent to the client, rather than sending only an empty HTML shell and relying on JavaScript to generate the page content.'}),"\n",(0,t.jsx)(n.p,{children:"In traditional client-side rendering, the server sends an empty HTML shell and some JavaScript scripts to the client, and then fetching data from the server's API and fills the page with dynamic content. This leads to slow initial page loading times and is not conducive to user experience and SEO."}),"\n",(0,t.jsx)(n.p,{children:"With SSR, the server generates HTML that already contains dynamic content and sends it to the client. This makes the initial page loading faster and more SEO-friendly, as search engines can crawl the rendered page."}),"\n",(0,t.jsxs)(n.h2,{id:"file-structure",children:["File Structure",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#file-structure",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"A typical SSR application will have the following files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"- index.html\n- server.js          # main application server\n- src/\n  - App.js           # exports app code\n  - index.client.js  # client entry, mounts the app to a DOM element\n  - index.server.js  # server entry, renders the app using the framework's SSR API\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"index.html"})," will need to include a placeholder where the server-rendered markup should be injected:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<div id="root">\x3c!--app-content--\x3e</div>\n'})}),"\n",(0,t.jsxs)(n.h2,{id:"create-ssr-configuration",children:["Create SSR configuration",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#create-ssr-configuration",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"In the SSR scenario, two types of outputs (web and node targets), need to be generated at the same time, for client-side rendering (CSR) and server-side rendering (SSR) respectively."}),"\n",(0,t.jsxs)(n.p,{children:["At this time, you can use Rsbuild's ",(0,t.jsx)(n.a,{href:"/guide/advanced/environments",children:"multi-environment builds"})," capability, define the following configuration:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",meta:"title=rsbuild.config.ts",children:"export default {\n  environments: {\n    // Configure the web environment for browsers\n    web: {\n      source: {\n        entry: {\n          index: './src/index.client.js',\n        },\n      },\n      output: {\n        // Use 'web' target for the browser outputs\n        target: 'web',\n      },\n      html: {\n        // Custom HTML template\n        template: './index.html',\n      },\n    },\n    // Configure the node environment for SSR\n    node: {\n      source: {\n        entry: {\n          index: './src/index.server.js',\n        },\n      },\n      output: {\n        // Use 'node' target for the Node.js outputs\n        target: 'node',\n      },\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"custom-server",children:["Custom server",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#custom-server",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Rsbuild does not have built-in SSR rendering capabilities, but you can implement SSR rendering through Rsbuild's ",(0,t.jsx)(n.a,{href:"/guide/basic/server#custom-server",children:"custom server"})," and ",(0,t.jsx)(n.a,{href:"/guide/advanced/environments#environment-api",children:"environment API"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",meta:"title=server.mjs",children:"import express from 'express';\nimport { createRsbuild, loadConfig } from '@rsbuild/core';\n\n// Implement SSR rendering function\nconst serverRender = (serverAPI) => async (_req, res) => {\n  // Load Node bundle for SSR\n  const indexModule = await serverAPI.environments.node.loadBundle('index');\n\n  const markup = indexModule.render();\n\n  const template = await serverAPI.environments.web.getTransformedHtml('index');\n\n  // Insert SSR rendering content into HTML template\n  const html = template.replace('\x3c!--app-content--\x3e', markup);\n\n  res.writeHead(200, {\n    'Content-Type': 'text/html',\n  });\n  res.end(html);\n};\n\n// Custom server\nasync function startDevServer() {\n  const { content } = await loadConfig({});\n\n  const rsbuild = await createRsbuild({\n    rsbuildConfig: content,\n  });\n\n  const app = express();\n\n  const rsbuildServer = await rsbuild.createDevServer();\n\n  const serverRenderMiddleware = serverRender(rsbuildServer);\n\n  // SSR rendering when accessing /index.html\n  app.get('/', async (req, res, next) => {\n    try {\n      await serverRenderMiddleware(req, res, next);\n    } catch (err) {\n      logger.error('SSR render error, downgrade to CSR...\\n', err);\n      next();\n    }\n  });\n\n  app.use(rsbuildServer.middlewares);\n\n  const httpServer = app.listen(rsbuildServer.port, async () => {\n    await rsbuildServer.afterListen();\n  });\n\n  rsbuildServer.connectWebSocket({ server: httpServer });\n}\n\nstartDevServer(process.cwd());\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"modify-startup-script",children:["Modify startup script",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#modify-startup-script",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["After using a custom Server, you need to change the startup command from ",(0,t.jsx)(n.code,{children:"rsbuild dev"})," to ",(0,t.jsx)(n.code,{children:"node ./server.mjs"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If you need to preview the online effect of SSR rendering, you also need to modify the preview command. SSR Prod Server example reference: ",(0,t.jsx)(n.a,{href:"https://github.com/rspack-contrib/rspack-examples/blob/main/rsbuild/ssr-express/prod-server.mjs",target:"_blank",rel:"noopener noreferrer",children:"Example"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",meta:"title=package.json",children:'{\n  "scripts": {\n    "build": "rsbuild build",\n    "dev": "node ./server.mjs",\n    "preview": "node ./prod-server.mjs"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Now, you can run the ",(0,t.jsx)(n.code,{children:"npm run dev"})," command to start the dev server with SSR rendering function, and visit ",(0,t.jsx)(n.code,{children:"http://localhost:3000/"})," to see that the SSR content has been rendered to the HTML page."]}),"\n",(0,t.jsxs)(n.h2,{id:"get-manifest",children:["Get Manifest",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#get-manifest",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["By default, scripts and links associated with the current page are automatically inserted into the HTML template. At this time, the compiled HTML template content can be obtained through ",(0,t.jsx)(n.a,{href:"/guide/advanced/environments#environment-api",children:"getTransformedHtml"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["When you need to dynamically generate HTML on the server side, you'll need to inject the URLs of JavaScript and CSS assets into the HTML. By configuring ",(0,t.jsx)(n.a,{href:"/config/output/manifest",children:"output.manifest"}),", you can easily obtain the manifest information of these assets. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",meta:"title=rsbuild.config.ts",children:"export default {\n  output: {\n    manifest: true,\n  },\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",meta:"title=server.ts",children:"async function renderHtmlPage(): Promise<string> {\n  const manifest = await fs.promises.readFile('./dist/manifest.json', 'utf-8');\n  const { entries } = JSON.parse(manifest);\n\n  const { js, css } = entries['index'].initial;\n\n  const scriptTags = js\n    .map((url) => `<script src=\"${url}\" defer><\/script>`)\n    .join('\\n');\n  const styleTags = css\n    .map((file) => `<link rel=\"stylesheet\" href=\"${file}\">`)\n    .join('\\n');\n\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        ${scriptTags}\n        ${styleTags}\n      </head>\n      <body>\n        <div id=\"root\"></div>\n      </body>\n    </html>`;\n}\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"examples",children:["Examples",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#examples",children:"#"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/rspack-contrib/rspack-examples/blob/main/rsbuild/ssr-express",target:"_blank",rel:"noopener noreferrer",children:"SSR + Express Example"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/rspack-contrib/rspack-examples/blob/main/rsbuild/ssr-express-with-manifest",target:"_blank",rel:"noopener noreferrer",children:"SSR + Express + Manifest Example"})}),"\n"]})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(i,{...e})}):i(e)}let d=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["en%2Fguide%2Fadvanced%2Fssr.mdx"]={toc:[{text:"What is SSR",id:"what-is-ssr",depth:2},{text:"File Structure",id:"file-structure",depth:2},{text:"Create SSR configuration",id:"create-ssr-configuration",depth:2},{text:"Custom server",id:"custom-server",depth:2},{text:"Modify startup script",id:"modify-startup-script",depth:2},{text:"Get Manifest",id:"get-manifest",depth:2},{text:"Examples",id:"examples",depth:2}],title:"Server-Side Rendering (SSR)",frontmatter:{}}}}]);