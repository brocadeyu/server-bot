"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["3150"],{1689:function(e,r,s){s.r(r),s.d(r,{default:function(){return c}});var n=s(55367),d=s(26971);function l(e){let r=Object.assign({h1:"h1",a:"a",p:"p",code:"code",h2:"h2",pre:"pre",img:"img",h3:"h3",ul:"ul",li:"li",strong:"strong",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",blockquote:"blockquote"},(0,d.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.h1,{id:"开发服务器",children:["开发服务器",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#开发服务器",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild 配备了一个内置的开发服务器，旨在提升开发体验。当你执行 ",(0,n.jsx)(r.code,{children:"rsbuild dev"})," 或 ",(0,n.jsx)(r.code,{children:"rsbuild preview"})," 命令时，该服务器将启动，并提供页面预览、路由、模块热更新等功能。"]}),"\n",(0,n.jsxs)(r.h2,{id:"服务端基础路径",children:["服务端基础路径",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#服务端基础路径",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["默认情况下，服务端的基础路径为 ",(0,n.jsx)(r.code,{children:"/"}),"，用户可通过 ",(0,n.jsx)(r.a,{href:"http://localhost:3000/",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/"})," 访问到 ",(0,n.jsx)(r.code,{children:"index.html"})," 等产物资源、以及 public 目录下的资源。"]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild 支持通过 ",(0,n.jsx)(r.a,{href:"/config/server/base",children:"server.base"})," 修改服务端的基础路径。当我们希望通过 ",(0,n.jsx)(r.a,{href:"http://localhost:3000/foo/",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/foo/"})," 访问到这些资源时，可以添加如下配置："]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"export default {\n  server: {\n    base: '/foo',\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h2,{id:"查看静态资源",children:["查看静态资源",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#查看静态资源",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["启动 dev server 后，你可以访问 ",(0,n.jsx)(r.code,{children:"/rsbuild-dev-server"})," 查看 Rsbuild 在当前构建中生成的所有静态资源。"]}),"\n",(0,n.jsxs)(r.p,{children:["例如，在浏览器中打开 ",(0,n.jsx)(r.code,{children:"http://localhost:3000/rsbuild-dev-server"}),"，可以看到："]}),"\n",(0,n.jsx)("img",{src:"https://assets.rspack.dev/rsbuild/assets/assets-report-page.png",alt:"rsbuild-dev-server",width:"600"}),"\n",(0,n.jsxs)(r.h2,{id:"页面路由",children:["页面路由",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#页面路由",children:"#"})]}),"\n",(0,n.jsx)(r.p,{children:"Rsbuild 的 Server 提供一套默认的路由约定，并允许用户通过配置项定制。"}),"\n",(0,n.jsxs)(r.h3,{id:"默认行为",children:["默认行为",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#默认行为",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild Server 会根据 ",(0,n.jsx)(r.a,{href:"/config/server/base",children:"server.base"})," 和 ",(0,n.jsx)(r.a,{href:"/config/source/entry",children:"source.entry"})," 配置生成对应的页面路由。"]}),"\n",(0,n.jsxs)(r.p,{children:["当 entry 为 index 时，可通过 ",(0,n.jsx)(r.code,{children:"/"})," 访问页面；当 entry 为 foo 时，可通过 ",(0,n.jsx)(r.code,{children:"/foo"})," 访问该页面。"]}),"\n",(0,n.jsxs)(r.p,{children:["当 server.base 为 ",(0,n.jsx)(r.code,{children:"/base"})," 时，可通过 ",(0,n.jsx)(r.code,{children:"/base"})," 访问 index 页面，通过 ",(0,n.jsx)(r.code,{children:"/base/foo"})," 访问 foo 页面。"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"export default {\n  source: {\n    entry: {\n      index: './src/index.ts',\n      foo: './src/pages/foo/index.ts',\n    },\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h3,{id:"fallback-行为",children:["Fallback 行为",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#fallback-行为",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["当请求满足以下条件且未找到对应资源时，会被 ",(0,n.jsx)(r.code,{children:"server.htmlFallback"})," 处理，默认会回退到 index.html。"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"当前请求是 GET 或 HEAD 请求"}),"\n",(0,n.jsxs)(r.li,{children:["当前请求头接受 ",(0,n.jsx)(r.code,{children:"text/html"})," (请求头 accept 类型为 ",(0,n.jsx)(r.code,{children:"text/html"})," 或 ",(0,n.jsx)(r.code,{children:"*/*"}),")"]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",meta:"title=rsbuild.config.ts",children:"export default {\n  server: {\n    htmlFallback: 'index',\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h3,{id:"自定义-fallback-行为",children:["自定义 Fallback 行为",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义-fallback-行为",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["当 Rsbuild 默认的 ",(0,n.jsx)(r.a,{href:"/config/server/html-fallback",children:"server.htmlFallback"})," 配置无法满足你的需求，例如，希望在访问 ",(0,n.jsx)(r.code,{children:"/"})," 时可以访问 ",(0,n.jsx)(r.code,{children:"main.html"}),"，可通过 ",(0,n.jsx)(r.a,{href:"/config/server/history-api-fallback",children:"server.historyApiFallback"})," 进行设置。"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",meta:"title=rsbuild.config.ts",children:"export default {\n  source: {\n    entry: {\n      main: './src/index.ts',\n    },\n  },\n  server: {\n    htmlFallback: false,\n    historyApiFallback: {\n      index: '/main.html',\n    },\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h3,{id:"html-输出路径",children:["HTML 输出路径",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#html-输出路径",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["通常情况下，",(0,n.jsx)(r.code,{children:"/"})," 指向 dist 产物根目录， 而 HTML 文件输出到 dist 根目录下，此时可通过 ",(0,n.jsx)(r.code,{children:"/some-path"})," 访问对应的 HTML 页面。"]}),"\n",(0,n.jsxs)(r.p,{children:["若通过修改 ",(0,n.jsx)(r.a,{href:"/config/output/dist-path",children:"output.distPath.html"})," 将 HTML 文件输出到其他子目录下，此时需通过 ",(0,n.jsx)(r.code,{children:"/[htmlPath]/some-path"})," 访问对应的 HTML 页面。"]}),"\n",(0,n.jsxs)(r.p,{children:["例如，设置将 HTML 文件输出到 ",(0,n.jsx)(r.code,{children:"HTML"})," 目录下，此时将通过 ",(0,n.jsx)(r.code,{children:"/html/"})," 访问到 index.html，通过 ",(0,n.jsx)(r.code,{children:"/html/foo"})," 访问到 foo.html。"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",children:"export default {\n  source: {\n    entry: {\n      index: './src/index.ts',\n      foo: './src/pages/foo/index.ts',\n    },\n  },\n  output: {\n    distPath: {\n      html: 'html',\n    },\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h2,{id:"rspack-dev-server",children:["Rspack Dev Server",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#rspack-dev-server",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rspack CLI 内置的开发服务器是 ",(0,n.jsx)(r.a,{href:"https://www.npmjs.com/package/@rspack/dev-server",target:"_blank",rel:"noopener noreferrer",children:"@rspack/dev-server"}),"，Rsbuild 没有使用 ",(0,n.jsx)(r.code,{children:"@rspack/dev-server"}),"，而是自行实现了一个更轻量的版本。"]}),"\n",(0,n.jsxs)(r.h3,{id:"对比",children:["对比",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#对比",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild 的开发服务器和 ",(0,n.jsx)(r.code,{children:"@rspack/dev-server"})," 有以下区别："]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"配置项"}),"：Rsbuild 提供了更丰富的 server 配置项。"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"日志格式"}),"：Rspack CLI 日志格式与 Webpack CLI 基本一致，而 Rsbuild 的日志则更加清晰和易读。"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"底层依赖"}),"：",(0,n.jsx)(r.code,{children:"@rspack/dev-server"})," 基于 express 实现，三方依赖较多。Rsbuild 则采用 ",(0,n.jsx)(r.code,{children:"connect"})," 等更轻量的库实现。"]}),"\n"]}),"\n",(0,n.jsxs)(r.h3,{id:"配置项",children:["配置项",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#配置项",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild 不支持使用 Rspack 的 ",(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server",target:"_blank",rel:"noopener noreferrer",children:"devServer"})," 配置项，你可以使用 Rsbuild 的 ",(0,n.jsx)(r.code,{children:"dev"})," 和 ",(0,n.jsx)(r.code,{children:"server"})," 配置代替。"]}),"\n",(0,n.jsxs)(r.p,{children:["在 Rsbuild 里，",(0,n.jsx)(r.code,{children:"dev"})," 包含一些仅在开发阶段生效的配置，而 ",(0,n.jsx)(r.code,{children:"server"})," 配置对开发服务器和 preview 服务器均能生效。"]}),"\n",(0,n.jsxs)(r.p,{children:["以下是 Rspack CLI 的 ",(0,n.jsx)(r.code,{children:"devServer"})," 配置对应的 Rsbuild 配置："]}),"\n",(0,n.jsxs)(r.table,{children:["\n",(0,n.jsxs)(r.thead,{children:["\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.th,{children:"Rspack CLI"}),"\n",(0,n.jsx)(r.th,{children:"Rsbuild"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.tbody,{children:["\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverclient",target:"_blank",rel:"noopener noreferrer",children:"devServer.client"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/dev/client",children:"dev.client"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devservercompress",target:"_blank",rel:"noopener noreferrer",children:"devServer.compress"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/compress",children:"server.compress"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverheaders",target:"_blank",rel:"noopener noreferrer",children:"devServer.headers"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/headers",children:"server.headers"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverhistoryapifallback",target:"_blank",rel:"noopener noreferrer",children:"devServer.historyApiFallback"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/history-api-fallback",children:"server.historyApiFallback"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverhost",target:"_blank",rel:"noopener noreferrer",children:"devServer.host"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/host",children:"server.host"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverhot",target:"_blank",rel:"noopener noreferrer",children:"devServer.hot"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/dev/hmr",children:"dev.hmr"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverlivereload",target:"_blank",rel:"noopener noreferrer",children:"devServer.liveReload"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/dev/live-reload",children:"dev.liveReload"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserveropen",target:"_blank",rel:"noopener noreferrer",children:"devServer.open"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/open",children:"server.open"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverport",target:"_blank",rel:"noopener noreferrer",children:"devServer.port"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/port",children:"server.port"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverproxy",target:"_blank",rel:"noopener noreferrer",children:"devServer.proxy"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/proxy",children:"server.proxy"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserversetupmiddlewares",target:"_blank",rel:"noopener noreferrer",children:"devServer.setupMiddlewares"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/dev/setup-middlewares",children:"dev.setupMiddlewares"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverstatic",target:"_blank",rel:"noopener noreferrer",children:"devServer.static"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/server/public-dir",children:"server.publicDir"})}),"\n"]}),"\n",(0,n.jsxs)(r.tr,{children:["\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"https://rspack.dev/config/dev-server#devserverwatchfiles",target:"_blank",rel:"noopener noreferrer",children:"devServer.watchFiles"})}),"\n",(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/config/dev/watch-files",children:"dev.watchFiles"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["更多配置请参考 ",(0,n.jsx)(r.a,{href:"/config/index",children:"Config 总览"}),"。"]}),"\n"]}),"\n",(0,n.jsxs)(r.h2,{id:"扩展中间件",children:["扩展中间件",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#扩展中间件",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["Rsbuild server 未使用任何 Node.js 框架，Rsbuild 中间件提供的 req 和 res 均为 Node.js 原生对象。\n这意味着，当你从其他服务端框架迁移时（如 Express），原本的中间件不一定能直接在 Rsbuild 中使用，例如，无法在 Rsbuild 中间件中访问 Express 所提供的 ",(0,n.jsx)(r.code,{children:"req.params"}),"、",(0,n.jsx)(r.code,{children:"req.path"}),"、",(0,n.jsx)(r.code,{children:"req.search"}),"、",(0,n.jsx)(r.code,{children:"req.query"})," 等属性。"]}),"\n",(0,n.jsx)(r.p,{children:"如果你需要在 Rsbuild 中使用原有的中间件，可以采取以下方式，将服务端应用作为中间件传入："}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"import expressMiddleware from 'my-express-middleware';\nimport express from 'express';\n\n// 初始化 Express app\nconst app = express();\n\napp.use(expressMiddleware);\n\nexport default {\n  dev: {\n    setupMiddlewares: [\n      (middleware) => {\n        middleware.unshift(app);\n      },\n    ],\n  },\n};\n"})}),"\n",(0,n.jsxs)(r.h2,{id:"自定义-server",children:["自定义 Server",(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义-server",children:"#"})]}),"\n",(0,n.jsxs)(r.p,{children:["如果你希望将 Rsbuild dev server 集成到自定义的 server 中，可以通过 Rsbuild ",(0,n.jsx)(r.code,{children:"createDevServer"})," 方法获取 Rsbuild dev server 的实例方法，进行按需调用。"]}),"\n",(0,n.jsxs)(r.p,{children:["详情可参考 ",(0,n.jsx)(r.a,{href:"/api/javascript-api/instance#rsbuildcreatedevserver",children:"Rsbuild - createDevServer"}),"。"]})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,d.ah)(),e.components);return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}let c=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["zh%2Fguide%2Fbasic%2Fserver.mdx"]={toc:[{text:"服务端基础路径",id:"服务端基础路径",depth:2},{text:"查看静态资源",id:"查看静态资源",depth:2},{text:"页面路由",id:"页面路由",depth:2},{text:"默认行为",id:"默认行为",depth:3},{text:"Fallback 行为",id:"fallback-行为",depth:3},{text:"自定义 Fallback 行为",id:"自定义-fallback-行为",depth:3},{text:"HTML 输出路径",id:"html-输出路径",depth:3},{text:"Rspack Dev Server",id:"rspack-dev-server",depth:2},{text:"对比",id:"对比",depth:3},{text:"配置项",id:"配置项",depth:3},{text:"扩展中间件",id:"扩展中间件",depth:2},{text:"自定义 Server",id:"自定义-server",depth:2}],title:"开发服务器",frontmatter:{}}}}]);