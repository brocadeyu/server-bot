"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["605"],{21246:function(n,e,i){i.r(e),i.d(e,{default:function(){return t}});var s=i(55367),o=i(26971);function l(n){let e=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",h2:"h2",pre:"pre",code:"code",h3:"h3",strong:"strong",div:"div",ol:"ol"},(0,o.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"plugin-system",children:["Plugin System",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#plugin-system",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Rsbuild provides a lightweight yet powerful plugin system to implement most of its functionality and allows for user extension."}),"\n",(0,s.jsx)(e.p,{children:"Plugins written by developers can modify the default behavior of Rsbuild and add various additional features, including but not limited to:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Get context information"}),"\n",(0,s.jsx)(e.li,{children:"Register lifecycle hooks"}),"\n",(0,s.jsx)(e.li,{children:"Transform module source code"}),"\n",(0,s.jsx)(e.li,{children:"Modify Rspack configuration"}),"\n",(0,s.jsx)(e.li,{children:"Modify Rsbuild configuration"}),"\n",(0,s.jsx)(e.li,{children:"..."}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"comparison",children:["Comparison",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#comparison",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Before developing a Rsbuild plugin, you may have been familiar with the plugin systems of tools such as Webpack, Vite, esbuild, etc."}),"\n",(0,s.jsx)(e.p,{children:"Generally, Rsbuild's plugin API is similar to esbuild, and compared with Webpack / Rspack plugins, Rsbuild's plugin API is more simple and easier to get started with."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"// esbuild plugin\nconst esbuildPlugin = {\n  name: 'example',\n  setup(build) {\n    build.onEnd(() => console.log('done'));\n  },\n};\n\n// Rsbuild plugin\nconst rsbuildPlugin = () => ({\n  name: 'example',\n  setup(api) {\n    api.onAfterBuild(() => console.log('done'));\n  },\n});\n\n// Rspack plugin\nclass RspackExamplePlugin {\n  apply(compiler) {\n    compiler.hooks.done.tap('RspackExamplePlugin', () => {\n      console.log('done');\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"From a functional perspective, Rsbuild's plugin API mainly revolves around Rsbuild's operation process and build configuration and provides some hooks for extension. On the other hand, Rspack's plugin API is more complex and rich, capable of modifying every aspect of the bundling process."}),"\n",(0,s.jsx)(e.p,{children:"Rspack plugins can be integrated into Rsbuild plugins. If the hooks provided by Rsbuild do not meet your requirements, you can also implement the functionality using Rspack plugin and register Rspack plugins in the Rsbuild plugin:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const rsbuildPlugin = () => ({\n  name: 'example',\n  setup(api) {\n    api.modifyRspackConfig((config) => {\n      config.plugins?.push(new RspackExamplePlugin());\n    });\n  },\n});\n"})}),"\n",(0,s.jsxs)(e.h2,{id:"developing-plugins",children:["Developing Plugins",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#developing-plugins",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["Plugins provide a function similar to ",(0,s.jsx)(e.code,{children:"(options?: PluginOptions) => RsbuildPlugin"})," as an entry point."]}),"\n",(0,s.jsxs)(e.h3,{id:"plugin-example",children:["Plugin Example",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#plugin-example",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",meta:'title="pluginFoo.ts"',children:"import type { RsbuildPlugin } from '@rsbuild/core';\n\nexport type PluginFooOptions = {\n  message?: string;\n};\n\nexport const pluginFoo = (options: PluginFooOptions = {}): RsbuildPlugin => ({\n  name: 'plugin-foo',\n\n  setup(api) {\n    api.onAfterStartDevServer(() => {\n      const msg = options.message || 'hello!';\n      console.log(msg);\n    });\n  },\n});\n"})}),"\n",(0,s.jsx)(e.p,{children:"Registering the plugin:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",meta:'title="rsbuild.config.ts"',children:"import { pluginFoo } from './pluginFoo';\n\nexport default {\n  plugins: [pluginFoo({ message: 'world!' })],\n};\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"plugin-structure",children:["Plugin Structure",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#plugin-structure",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["Function-based plugins can ",(0,s.jsx)(e.strong,{children:"accept an options object"})," and ",(0,s.jsx)(e.strong,{children:"return a plugin instance"}),", managing internal state through closures."]}),"\n",(0,s.jsx)(e.p,{children:"The roles of each part are as follows:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["The ",(0,s.jsx)(e.code,{children:"name"})," property is used to label the plugin's name."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"setup"})," serves as the main entry point for the plugin logic."]}),"\n",(0,s.jsxs)(e.li,{children:["The ",(0,s.jsx)(e.code,{children:"api"})," object contains various hooks and utility functions."]}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"naming-convention",children:["Naming Convention",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#naming-convention",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"The naming convention for plugins is as follows:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["The function of the plugin is named ",(0,s.jsx)(e.code,{children:"pluginAbc"})," and exported by name."]}),"\n",(0,s.jsxs)(e.li,{children:["The ",(0,s.jsx)(e.code,{children:"name"})," of the plugin follows the format ",(0,s.jsx)(e.code,{children:"scope:foo-bar"})," or ",(0,s.jsx)(e.code,{children:"plugin-foo-bar"}),", adding ",(0,s.jsx)(e.code,{children:"scope:"})," can avoid naming conflicts with other plugins."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Here is an example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",meta:'title="pluginFooBar.ts"',children:"import type { RsbuildPlugin } from '@rsbuild/core';\n\nexport const pluginFooBar = (): RsbuildPlugin => ({\n  name: 'scope:foo-bar',\n  setup() {},\n});\n"})}),"\n",(0,s.jsxs)(e.div,{className:"rspress-directive tip",children:[(0,s.jsx)(e.div,{className:"rspress-directive-title",children:"TIP"}),(0,s.jsx)(e.div,{className:"rspress-directive-content",children:(0,s.jsxs)(e.p,{children:["The ",(0,s.jsx)(e.code,{children:"name"})," of official Rsbuild plugins uniformly uses ",(0,s.jsx)(e.code,{children:"rsbuild:"})," as a prefix, for example, ",(0,s.jsx)(e.code,{children:"rsbuild:react"})," corresponds to ",(0,s.jsx)(e.code,{children:"@rsbuild/plugin-react"}),".\n"]})})]}),"\n",(0,s.jsxs)(e.h3,{id:"template-repository",children:["Template Repository",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#template-repository",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://github.com/rspack-contrib/rsbuild-plugin-template",target:"_blank",rel:"noopener noreferrer",children:"rsbuild-plugin-template"})," is a minimal Rsbuild plugin template repository that you can use as a basis for developing your Rsbuild plugin."]}),"\n",(0,s.jsxs)(e.h3,{id:"environment-plugin",children:["Environment Plugin",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#environment-plugin",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["Rsbuild supports building outputs for multiple environments at the same time, and supports ",(0,s.jsx)(e.a,{href:"/guide/advanced/environments#add-plugins-for-specified-environment",children:"add plugins for specified environment"}),"."]}),"\n",(0,s.jsx)(e.p,{children:"If you want the plugin you develop to support use as an Environment plugin, you need to pay attention to the following points:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["Each environment has its own Rsbuild config:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Use ",(0,s.jsx)(e.a,{href:"/guide/advanced/environments#environment-context",children:"environment context"})," instead of ",(0,s.jsx)(e.code,{children:"getRsbuildConfig"})," to get environment information."]}),"\n",(0,s.jsxs)(e.li,{children:["When modifying the Rsbuild config for a specific environment, prioritize using ",(0,s.jsx)(e.a,{href:"/plugins/dev/hooks#modifyenvironmentconfig",children:"modifyEnvironmentConfig"})," instead of ",(0,s.jsx)(e.a,{href:"/plugins/dev/hooks#modifyrsbuildconfig",children:"modifyRsbuildConfig"})," to avoid affecting other environments."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Be aware of side effects, your plugin code may be executed multiple times:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"When the same plugin is registered multiple times in different environments, it will be regarded as multiple Rsbuild plugins (even if they point to the same plugin instance), because they have different Rsbuild environment contexts."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Here is an example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",meta:'title="pluginFoo.ts"',children:"import type { RsbuildPlugin } from '@rsbuild/core';\n\nexport type PluginFooOptions = {\n  title?: string;\n};\n\nexport const pluginFoo = (options: PluginFooOptions = {}): RsbuildPlugin => ({\n  name: 'plugin-foo',\n\n  setup: (api) => {\n    api.modifyEnvironmentConfig((config) => {\n      config.html.title = options.title || 'My Default Title';\n    });\n    api.modifyBundlerChain((chain, { environment }) => {\n      chain.name(environment.config.html.title);\n    });\n  },\n});\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"reference-other-plugins",children:["Reference Other Plugins",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#reference-other-plugins",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["Rsbuild's ",(0,s.jsx)(e.a,{href:"/config/plugins",children:"plugins"})," config supports passing a nested array, which means you can reference and register other Rsbuild plugins within your plugin."]}),"\n",(0,s.jsxs)(e.p,{children:["For example, register ",(0,s.jsx)(e.code,{children:"pluginBar"})," within ",(0,s.jsx)(e.code,{children:"pluginFoo"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import { pluginBar } from 'rsbuild-plugin-bar';\n\nexport const pluginFoo = (): RsbuildPlugin => {\n  const foo = {\n    name: 'plugin-foo',\n    setup(api) {\n      // ...\n    },\n  };\n  return [foo, pluginBar()];\n};\n"})}),"\n",(0,s.jsxs)(e.h2,{id:"lifetime-hooks",children:["Lifetime Hooks",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#lifetime-hooks",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Rsbuild uses lifetime planning work internally, and plugins can also register hooks to take part in any stage of the workflow and implement their own features."}),"\n",(0,s.jsxs)(e.p,{children:["The full list of Rsbuild's lifetime hooks can be found in the ",(0,s.jsx)(e.a,{href:"/plugins/dev/hooks",children:"API References"}),"."]}),"\n",(0,s.jsxs)(e.p,{children:["The Rsbuild does not take over the hooks of the underlying Rspack, whose documents can be found here: ",(0,s.jsx)(e.a,{href:"https://rspack.dev/api/plugin-api",target:"_blank",rel:"noopener noreferrer",children:"Rspack Plugin API"}),"."]}),"\n",(0,s.jsxs)(e.h2,{id:"use-rsbuild-config",children:["Use Rsbuild Config",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#use-rsbuild-config",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Custom plugins can usually get config from function parameters,\njust define and use it at your pleasure."}),"\n",(0,s.jsx)(e.p,{children:"But sometimes you may need to read and change the public config of the Rsbuild. To begin with, you should understand how the Rsbuild generates and uses its config:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Read, parse config and merge with default values."}),"\n",(0,s.jsxs)(e.li,{children:["Plugins modify the config by ",(0,s.jsx)(e.code,{children:"api.modifyRsbuildConfig(...)"}),"."]}),"\n",(0,s.jsx)(e.li,{children:"Normalize the config and provide it to consume, then the config can no longer be modified."}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Refer to this tiny example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"export const pluginUploadDist = (): RsbuildPlugin => ({\n  name: 'plugin-upload-dist',\n  setup(api) {\n    api.modifyRsbuildConfig((config) => {\n      // try to disable minimize.\n      config.output ||= {};\n      config.output.minify = false;\n      // but also can be enable by other plugins...\n    });\n    api.onBeforeBuild(() => {\n      // use the normalized config.\n      const config = api.getNormalizedConfig();\n      if (config.output.minify !== false) {\n        // let it crash when enable minimize.\n        throw new Error(\n          'You must disable minimize to upload readable dist files.',\n        );\n      }\n    });\n    api.onAfterBuild(() => {\n      const config = api.getNormalizedConfig();\n      const distRoot = config.output.distPath.root;\n\n      // upload all files in `distRoot`...\n    });\n  },\n});\n"})}),"\n",(0,s.jsx)(e.p,{children:"There are 3 ways to use Rsbuild config:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["register callback with ",(0,s.jsx)(e.code,{children:"api.modifyRsbuildConfig(config => {})"})," to modify config."]}),"\n",(0,s.jsxs)(e.li,{children:["use ",(0,s.jsx)(e.code,{children:"api.getRsbuildConfig()"})," to get Rsbuild config."]}),"\n",(0,s.jsxs)(e.li,{children:["use ",(0,s.jsx)(e.code,{children:"api.getNormalizedConfig()"})," to get finally normalized config."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"When normalized, it will again merge the config object with the default values\nand make sure the optional properties exist.\nSo for PluginUploadDist, part of its type looks like:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"api.modifyRsbuildConfig((config: RsbuildConfig) => {});\napi.getRsbuildConfig() as RsbuildConfig;\ntype RsbuildConfig = {\n  output?: {\n    minify?: boolean;\n    distPath?: { root?: string };\n  };\n};\n\napi.getNormalizedConfig() as NormalizedConfig;\ntype NormalizedConfig = {\n  output: {\n    minify: boolean;\n    distPath: { root: string };\n  };\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["The return value type of ",(0,s.jsx)(e.code,{children:"getNormalizedConfig()"})," is slightly different from that of ",(0,s.jsx)(e.code,{children:"RsbuildConfig"})," and is narrowed compared to the types described elsewhere in the documentation.\nYou don't need to fill in the defaults when you use it."]}),"\n",(0,s.jsx)(e.p,{children:"Therefore, the best way to use configuration options is to"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Modify the config"})," with ",(0,s.jsx)(e.code,{children:"api.modifyRsbuildConfig(config => {})"})]}),"\n",(0,s.jsxs)(e.li,{children:["Read ",(0,s.jsx)(e.code,{children:"api.getNormalizedConfig()"})," as the ",(0,s.jsx)(e.strong,{children:"actual config used by the plugin"})," in the further lifetime."]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"modify-rspack-configuration",children:["Modify Rspack Configuration",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#modify-rspack-configuration",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Rsbuild plugin allows you to modify the built-in Rspack configuration, including:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/plugins/dev/hooks#modifyrspackconfig",children:"api.modifyRspackConfig"}),": Modify the Rspack configuration object."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/plugins/dev/hooks#modifybundlerchain",children:"api.modifyBundlerChain"}),": Modify the Rspack configuration through ",(0,s.jsx)(e.a,{href:"https://github.com/rspack-contrib/rspack-chain",target:"_blank",rel:"noopener noreferrer",children:"rspack-chain"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"example",children:["Example",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#example",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["For example, register ",(0,s.jsx)(e.a,{href:"https://github.com/rspack-contrib/eslint-rspack-plugin",target:"_blank",rel:"noopener noreferrer",children:"eslint-rspack-plugin"})," via Rsbuild plugin:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import type { RsbuildPlugin } from '@rsbuild/core';\nimport ESLintRspackPlugin from 'eslint-rspack-plugin';\n\nexport const pluginEslint = (options?: Options): RsbuildPlugin => ({\n  name: 'plugin-eslint',\n  setup(api) {\n    api.modifyRspackConfig((config) => {\n      config.plugins?.push(\n        new ESLintRspackPlugin({\n          // plugins options\n        }),\n      );\n    });\n  },\n});\n"})})]})}function r(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,o.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}let t=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["en%2Fplugins%2Fdev%2Findex.mdx"]={toc:[{text:"Comparison",id:"comparison",depth:2},{text:"Developing Plugins",id:"developing-plugins",depth:2},{text:"Plugin Example",id:"plugin-example",depth:3},{text:"Plugin Structure",id:"plugin-structure",depth:3},{text:"Naming Convention",id:"naming-convention",depth:3},{text:"Template Repository",id:"template-repository",depth:3},{text:"Environment Plugin",id:"environment-plugin",depth:3},{text:"Reference Other Plugins",id:"reference-other-plugins",depth:3},{text:"Lifetime Hooks",id:"lifetime-hooks",depth:2},{text:"Use Rsbuild Config",id:"use-rsbuild-config",depth:2},{text:"Modify Rspack Configuration",id:"modify-rspack-configuration",depth:2},{text:"Example",id:"example",depth:3}],title:"Plugin System",frontmatter:{}}}}]);