"use strict";(self.webpackChunkrsbuild_website=self.webpackChunkrsbuild_website||[]).push([["9038"],{14250:function(e,n,s){s.r(n),s.d(n,{default:function(){return a}});var r=s(55367),d=s(26971);function i(e){let n=Object.assign({h1:"h1",a:"a",ul:"ul",li:"li",strong:"strong",pre:"pre",code:"code",p:"p",h2:"h2",h3:"h3"},(0,d.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"devsetupmiddlewares",children:["dev.setupMiddlewares",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#devsetupmiddlewares",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Type:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type SetupMiddlewaresServer = {\n  sockWrite: (\n    type: string,\n    data?: string | boolean | Record<string, any>,\n  ) => void;\n  environments: EnvironmentAPI;\n};\n\ntype SetupMiddlewares = Array<\n  (\n    middlewares: {\n      unshift: (...handlers: RequestHandler[]) => void;\n      push: (...handlers: RequestHandler[]) => void;\n    },\n    server: SetupMiddlewaresServer,\n  ) => void\n>;\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Provides the ability to execute a custom function and apply custom middlewares."}),"\n",(0,r.jsxs)(n.h2,{id:"execution-order",children:["Execution Order",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#execution-order",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["The order among several different types of middleware is: ",(0,r.jsx)(n.code,{children:"unshift"})," => internal middlewares => ",(0,r.jsx)(n.code,{children:"push"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"export default {\n  dev: {\n    setupMiddlewares: [\n      (middlewares, server) => {\n        middlewares.unshift((req, res, next) => {\n          console.log('first');\n          next();\n        });\n\n        middlewares.push((req, res, next) => {\n          console.log('last');\n          next();\n        });\n      },\n    ],\n  },\n};\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"server-api",children:["Server API",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#server-api",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.code,{children:"setupMiddlewares"})," function, you can access the ",(0,r.jsx)(n.code,{children:"server"})," object, which provides some server APIs."]}),"\n",(0,r.jsxs)(n.h3,{id:"sockwrite",children:["sockWrite",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sockwrite",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"sockWrite"})," allows middlewares to send some message to HMR client, and then the HMR client will take different actions depending on the message type."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, if you send a ",(0,r.jsx)(n.code,{children:"'content-changed'"})," message, the page will reload."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"export default {\n  dev: {\n    setupMiddlewares: [\n      (middlewares, server) => {\n        if (someCondition) {\n          server.sockWrite('content-changed');\n        }\n      },\n    ],\n  },\n};\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"environments",children:["environments",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#environments",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"environments"})," includes Rsbuild's ",(0,r.jsx)(n.a,{href:"/api/javascript-api/environment-api#environment-api",children:"environment API"}),", which allows you to get the build outputs information for a specific environment in the server side."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export default {\n  dev: {\n    setupMiddlewares: [\n      (middlewares, server) => {\n        middlewares.unshift(async (req, _res, next) => {\n          const webStats = await server.environments.web.getStats();\n\n          console.log(webStats.toJson({ all: false }));\n\n          next();\n        });\n      },\n    ],\n  },\n};\n"})})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}let a=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["en%2Fconfig%2Fdev%2Fsetup-middlewares.mdx"]={toc:[{text:"Execution Order",id:"execution-order",depth:2},{text:"Server API",id:"server-api",depth:2},{text:"sockWrite",id:"sockwrite",depth:3},{text:"environments",id:"environments",depth:3}],title:"dev.setupMiddlewares",frontmatter:{}}}}]);