{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Prioritized Task Scheduling API","mdn_url":"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API","locale":"en-US","native":"English (US)","browserCompat":["api.Scheduler","api.Scheduling"],"sidebarHTML":"<ol><li class=\"section\"><em><a href=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" aria-current=\"page\">Prioritized Task Scheduling API</a></em></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/Scheduler\"><code>Scheduler</code></a></li><li><a href=\"/en-US/docs/Web/API/Scheduling\"><code>Scheduling</code></a></li><li><a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a></li><li><a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a></li><li><a href=\"/en-US/docs/Web/API/TaskPriorityChangeEvent\"><code>TaskPriorityChangeEvent</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/Navigator/scheduling\"><code>Navigator.scheduling</code></a></li><li><a href=\"/en-US/docs/Web/API/Window/scheduler\"><code>Window.scheduler</code></a></li><li><a href=\"/en-US/docs/Web/API/WorkerGlobalScope/scheduler\"><code>WorkerGlobalScope.scheduler</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard note\">\n  <p><strong>Note:</strong> This feature is available in <a href=\"/en-US/docs/Web/API/Web_Workers_API\">Web Workers</a>.</p>\n</div>\n<p>The <strong>Prioritized Task Scheduling API</strong> provides a standardized way to prioritize all tasks belonging to an application, whether they are defined in a website developer's code or in third-party libraries and frameworks.</p>\n<p>The <a href=\"#task_priorities\">task priorities</a> are very coarse-grained and based around whether tasks block user interaction or otherwise impact the user experience, or can run in the background. Developers and frameworks may implement more fine-grained prioritization schemes within the broad categories defined by the API.</p>\n<p>The API is promise-based and supports the ability to set and change task priorities, to delay tasks being added to the scheduler, to abort tasks, and to monitor for priority change and abort events.</p>"}},{"type":"prose","value":{"id":"concepts_and_usage","title":"Concepts and usage","isH3":false,"content":"<p>The Prioritized Task Scheduling API is available in both window and worker threads using the <code>scheduler</code> property on the global object.</p>\n<p>The main API methods are <a href=\"/en-US/docs/Web/API/Scheduler/postTask\"><code>scheduler.postTask()</code></a> and <a href=\"/en-US/docs/Web/API/Scheduler/yield\"><code>scheduler.yield()</code></a>. <code>scheduler.postTask()</code> takes a callback function (the task) and returns a promise that resolves with the return value of the function or rejects with an error. <code>scheduler.yield()</code> turns any <a href=\"/en-US/docs/Web/JavaScript/Reference/Statements/async_function\"><code>async</code></a> function into a task by yielding the main thread to the browser for other work, with execution continuing when the returned promise is resolved.</p>\n<p>The two methods have similar functionality but different levels of control. <code>scheduler.postTask()</code> is more configurable â€” for example, it allows task priority to be explicitly set and task cancellation via an <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a>. <code>scheduler.yield()</code> on the other hand is simpler and can be <code>await</code>ed in any <code>async</code> function without having to provide a followup task in another function.</p>"}},{"type":"prose","value":{"id":"scheduler.yield","title":"<code>scheduler.yield()</code>","isH3":true,"content":"<p>To break up long-running JavaScript tasks so they don't block the main thread, insert a <code>scheduler.yield()</code> call to temporarily yield the main thread back to the browser, which creates a task to continue execution where it left off.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>async function slowTask() {\n  firstHalfOfWork();\n  await scheduler.yield();\n  secondHalfOfWork();\n}\n</code></pre></div>\n<p><code>scheduler.yield()</code> returns a promise that can be awaited to continue execution. This allows work belonging to the same function to be included there, without blocking the main thread when the function runs.</p>\n<p><code>scheduler.yield()</code> takes no arguments. The task that triggers its continuation has a default <a href=\"#user-visible\"><code>user-visible</code></a> priority; however, if <code>scheduler.yield()</code> is called within a <code>scheduler.postTask()</code> callback, it will <a href=\"/en-US/docs/Web/API/Scheduler/yield#inheriting_task_priorities\">inherit the priority of the surrounding task</a>.</p>"}},{"type":"prose","value":{"id":"scheduler.posttask","title":"<code>scheduler.postTask()</code>","isH3":true,"content":"<p>When <code>scheduler.postTask()</code> is called with no arguments, it creates a task with a default <a href=\"#user-visible\"><code>user-visible</code></a> priority that cannot be aborted or have its priority changed.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>const promise = scheduler.postTask(myTask);\n</code></pre></div>\n<p>Because the method returns a promise, you can wait on its resolution asynchronously using <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then\"><code>then()</code></a>, and catch errors thrown by the task callback function (or when the task is aborted) using <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch\"><code>catch</code></a>. The callback function can be any kind of function (below we demonstrate an arrow function).</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>scheduler\n  .postTask(() =&gt; \"Task executing\")\n  // Promise resolved: log task result when promise resolves\n  .then((taskResult) =&gt; console.log(`${taskResult}`))\n  // Promise rejected: log AbortError or errors thrown by task\n  .catch((error) =&gt; console.error(`Error: ${error}`));\n</code></pre></div>\n<p>The same task might be waited on using <code>await</code>/<code>async</code> as shown below (note, this is run in an <a href=\"/en-US/docs/Glossary/IIFE\">Immediately Invoked Function Expression (IIFE)</a>):</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>(async () =&gt; {\n  try {\n    const result = await scheduler.postTask(() =&gt; \"Task executing\");\n    console.log(result);\n  } catch (error) {\n    // Log AbortError or error thrown in task function\n    console.error(`Error: ${error}`);\n  }\n})();\n</code></pre></div>\n<p>\n  You can also specify an options object to the <code>postTask()</code> method if you want to change the default behavior.\n  The options are:\n</p>\n<ul>\n  <li>\n    <code>priority</code> This allows you to specify a particular immutable priority.\n    Once set, the priority cannot be changed.\n  </li>\n  <li>\n    <code>signal</code> This allows you to specify a signal, which may be either a <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> or <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a>\n    The signal is associated with a controller, which can be used to abort the task.\n    A <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> can also be used to set and change the task priority if the <a href=\"#mutable_and_immutable_task_priority\">task is mutable</a>.\n  </li>\n  <li><code>delay</code> This allows you to specify the delay before the task is added for scheduling, in milliseconds.</li>\n</ul>\n<p>The same example as above with a priority option would look like this:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>scheduler\n  .postTask(() =&gt; \"Task executing\", { priority: \"user-blocking\" })\n  .then((taskResult) =&gt; console.log(`${taskResult}`)) // Log the task result\n  .catch((error) =&gt; console.error(`Error: ${error}`)); // Log any errors\n</code></pre></div>"}},{"type":"prose","value":{"id":"task_priorities","title":"Task priorities","isH3":true,"content":"<p>Scheduled tasks are run in priority order, followed by the order that they were added to the scheduler queue.</p>\n<p>There are just three priorities, which are listed below (ordered from highest to lowest):</p>\n<dl>\n  <dt id=\"user-blocking\"><a href=\"#user-blocking\"><code>user-blocking</code></a></dt>\n  <dd>\n    <p>\n      Tasks that stop users from interacting with the page.\n      This includes rendering the page to the point where it can be used, or responding to user input.\n    </p>\n  </dd>\n  <dt id=\"user-visible\"><a href=\"#user-visible\"><code>user-visible</code></a></dt>\n  <dd>\n    <p>\n      Tasks that are visible to the user but not necessarily blocking user actions.\n      This might include rendering non-essential parts of the page, such as non-essential images or animations.\n    </p>\n    <p>This is the default priority for <code>scheduler.postTask()</code> and <code>scheduler.yield()</code>.</p>\n  </dd>\n  <dt id=\"background\"><a href=\"#background\"><code>background</code></a></dt>\n  <dd>\n    <p>\n      Tasks that are not time-critical.\n      This might include log processing or initializing third party libraries that aren't required for rendering.\n    </p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"mutable_and_immutable_task_priority","title":"Mutable and immutable task priority","isH3":true,"content":"<p>\n  There are many use cases where the task priority never needs to change, while for others it does.\n  For example fetching an image might change from a <code>background</code> task to <code>user-visible</code> as a carousel is scrolled into the viewing area.\n</p>\n<p>Task priorities can be set as static (immutable) or dynamic (modifiable) depending on the arguments passed to <a href=\"/en-US/docs/Web/API/Scheduler/postTask\"><code>Scheduler.postTask()</code></a>.</p>\n<p>\n  Task priority is immutable if a value is specified in the <code>options.priority</code> argument.\n  The given value will be used for the task priority and cannot be changed.\n</p>\n<p>\n  The priority is modifiable only if a <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> is passed to the <code>options.signal</code> argument <strong>and</strong> <code>options.priority</code> is <strong>not set</strong>.\n  In this case the task will take its initial priority from the <code>signal</code> priority, and the priority can subsequently be changed by calling <a href=\"/en-US/docs/Web/API/TaskController/setPriority\"><code>TaskController.setPriority()</code></a> on the controller associated with the signal.\n</p>\n<p>If the priority is not set with <code>options.priority</code> or by passing a <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> to <code>options.signal</code> then it defaults to <code>user-visible</code> (and is by definition immutable).</p>\n<p>\n  Note that a task that needs to be aborted must set <code>options.signal</code> to either <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> or <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a>.\n  However for a task with an immutable priority, <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a> more clearly indicates that the task priority cannot be changed using the signal.\n</p>\n<p>Let's run through an example to demonstrate what we mean by this. When you have several tasks that are of roughly the same priority, it makes sense to break them down into separate functions to aid with maintenance, debugging, and many other reasons.</p>\n<p>For example:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>function main() {\n  a();\n  b();\n  c();\n  d();\n  e();\n}\n</code></pre></div>\n<p>However, this kind of structure doesn't help with main thread blocking. Since all five of the tasks are being run inside one main function, the browser runs them all as a single task.</p>\n<p>To handle this, we tend to run a function periodically to get the code to <em>yield to the main thread</em>. This means that our code is split into multiple tasks, between the execution of which the browser is given the opportunity to handle high-priority tasks such as updating the UI. A common pattern for this function uses <a href=\"/en-US/docs/Web/API/Window/setTimeout\" title=\"setTimeout()\"><code>setTimeout()</code></a> to postpone execution into a separate task:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>function yield() {\n  return new Promise((resolve) =&gt; {\n    setTimeout(resolve, 0);\n  });\n}\n</code></pre></div>\n<p>This can be used inside a task runner pattern like so, to yield to the main thread after each task has been run:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>async function main() {\n  // Create an array of functions to run\n  const tasks = [a, b, c, d, e];\n\n  // Loop over the tasks\n  while (tasks.length &gt; 0) {\n    // Shift the first task off the tasks array\n    const task = tasks.shift();\n\n    // Run the task\n    task();\n\n    // Yield to the main thread\n    await yield();\n  }\n}\n</code></pre></div>\n<p>To improve this further, we can use <a href=\"/en-US/docs/Web/API/Scheduler/yield\"><code>Scheduler.yield</code></a> when available to allow this code to continue executing ahead of other less critical tasks in the queue:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>function yield() {\n  // Use scheduler.yield if it exists:\n  if (\"scheduler\" in window &amp;&amp; \"yield\" in scheduler) {\n    return scheduler.yield();\n  }\n\n  // Fall back to setTimeout:\n  return new Promise((resolve) =&gt; {\n    setTimeout(resolve, 0);\n  });\n}\n</code></pre></div>"}},{"type":"prose","value":{"id":"interfaces","title":"Interfaces","isH3":false,"content":"<dl>\n  <dt id=\"scheduler\"><a href=\"/en-US/docs/Web/API/Scheduler\"><code>Scheduler</code></a></dt>\n  <dd>\n    <p>\n      Contains the <a href=\"/en-US/docs/Web/API/Scheduler/postTask\" title=\"postTask()\"><code>postTask()</code></a> and <a href=\"/en-US/docs/Web/API/Scheduler/yield\" title=\"yield()\"><code>yield()</code></a> methods for adding prioritized tasks to be scheduled.\n      An instance of this interface is available on the <a href=\"/en-US/docs/Web/API/Window\"><code>Window</code></a> or <a href=\"/en-US/docs/Web/API/WorkerGlobalScope\"><code>WorkerGlobalScope</code></a> global objects (<code>globalThis.scheduler</code>).\n    </p>\n  </dd>\n  <dt id=\"taskcontroller\"><a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a></dt>\n  <dd>\n    <p>Supports both aborting a task and changing its priority.</p>\n  </dd>\n  <dt id=\"tasksignal\"><a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a></dt>\n  <dd>\n    <p>A signal object that allows you to abort a task and change its priority, if required, using a <a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a> object.</p>\n  </dd>\n  <dt id=\"taskprioritychangeevent\"><a href=\"/en-US/docs/Web/API/TaskPriorityChangeEvent\"><code>TaskPriorityChangeEvent</code></a></dt>\n  <dd>\n    <p>The interface for the <a href=\"/en-US/docs/Web/API/TaskSignal/prioritychange_event\" title=\"prioritychange\"><code>prioritychange</code></a> event, which is sent when the priority for a task is changed.</p>\n  </dd>\n</dl>\n<div class=\"notecard note\">\n  <p><strong>Note:</strong> If the <a href=\"#task_priorities\">task priority</a> never needs to be changed, you can use an <a href=\"/en-US/docs/Web/API/AbortController\"><code>AbortController</code></a> and its associated <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a> instead of <a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a> and <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a>.</p>\n</div>"}},{"type":"prose","value":{"id":"extensions_to_other_interfaces","title":"Extensions to other interfaces","isH3":true,"content":"<dl>\n  <dt id=\"window.scheduler\"><a href=\"/en-US/docs/Web/API/Window/scheduler\"><code>Window.scheduler</code></a> and <a href=\"/en-US/docs/Web/API/WorkerGlobalScope/scheduler\"><code>WorkerGlobalScope.scheduler</code></a></dt>\n  <dd>\n    <p>These properties are the entry points for using the <code>Scheduler.postTask()</code> method in a window or a worker scope, respectively.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"examples","title":"Examples","isH3":false,"content":"<p>\n  Note that the examples below use <code>myLog()</code> to write to a text area.\n  The code for the log area and method is generally hidden to not distract from more relevant code.\n</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 20px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// hidden logger code - simplifies example\nlet log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>"}},{"type":"prose","value":{"id":"feature_checking","title":"Feature checking","isH3":true,"content":"<p>Check whether prioritized task scheduling is supported by testing for the <code>scheduler</code> property in the global scope.</p>\n<p>The code below prints \"Feature: Supported\" if the API is supported on this browser.</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 20px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>//hidden logger code - simplifies example\nlet log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// Check that feature is supported\nif (\"scheduler\" in globalThis) {\n  myLog(\"Feature: Supported\");\n} else {\n  myLog(\"Feature: NOT Supported\");\n}\n</code></pre></div><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Feature checking sample\" id=\"frame_feature_checking\" width=\"400px\" height=\"70px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"feature_checking\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"prose","value":{"id":"basic_usage","title":"Basic usage","isH3":true,"content":"<p>\n  Tasks are posted using <a href=\"/en-US/docs/Web/API/Scheduler/postTask\"><code>Scheduler.postTask()</code></a>, specifying a callback function (task) in the first argument, and an optional second argument that can be used to specify a task priority, signal, and/or delay.\n  The method returns a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves with the return value of the callback function, or rejects with either an abort error or an error thrown in the function.\n</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 100px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>let log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<p>\n  Because it returns a promise, <a href=\"/en-US/docs/Web/API/Scheduler/postTask\"><code>Scheduler.postTask()</code></a> can be <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#chained_promises\">chained with other promises</a>.\n  Below we show how to wait on the promise to resolve using <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then\"><code>then</code></a>.\n  This uses the default priority (<code>user-visible</code>).\n</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// A function that defines a task\nfunction myTask() {\n  return \"Task 1: user-visible\";\n}\n\nif (\"scheduler\" in this) {\n  // Post task with default priority: 'user-visible' (no other options)\n  // When the task resolves, Promise.then() logs the result.\n  scheduler.postTask(myTask).then((taskResult) =&gt; myLog(`${taskResult}`));\n}\n</code></pre></div>\n<p>\n  The method can also be used with <a href=\"/en-US/docs/Web/JavaScript/Reference/Operators/await\"><code>await</code></a> inside an <a href=\"/en-US/docs/Web/JavaScript/Reference/Statements/async_function\">async function</a>.\n  The code below shows how you might use this approach to wait on a <code>user-blocking</code> task.\n</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>function myTask2() {\n  return \"Task 2: user-blocking\";\n}\n\nasync function runTask2() {\n  const result = await scheduler.postTask(myTask2, {\n    priority: \"user-blocking\",\n  });\n  myLog(result); // Logs 'Task 2: user-blocking'.\n}\nrunTask2();\n</code></pre></div>\n<p>\n  In some cases you might not need to wait on completion at all.\n  For simplicity many of the examples here simply log the result as the task executes.\n</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// A function that defines a task\nfunction myTask3() {\n  myLog(\"Task 3: user-visible\");\n}\n\nif (\"scheduler\" in this) {\n  // Post task and log result when it runs\n  scheduler.postTask(myTask3);\n}\n</code></pre></div>\n<p>\n  The log below shows the output of the three tasks above.\n  Note that the order they are run depends on the priority first, and then the declaration order.\n</p><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Basic usage sample\" id=\"frame_basic_usage\" width=\"400px\" height=\"170px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"basic_usage\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"prose","value":{"id":"permanent_priorities","title":"Permanent priorities","isH3":true,"content":"<p>\n  <a href=\"#task_priorities\">Task priorities</a> may be set using <code>priority</code> parameter in the optional second argument.\n  Priorities that are set in this way are <a href=\"#mutable_and_immutable_task_priority\">immutable</a> (cannot be changed).\n</p>\n<p>\n  Below we post two groups of three tasks, each member in reverse order of priority.\n  The final task has the default priority.\n  When run, each task simply logs it's expected order (we're not waiting on the result because we don't need to in order to show execution order).\n</p>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>let log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>if (\"scheduler\" in this) {\n  // three tasks, in reverse order of priority\n  scheduler.postTask(() =&gt; myLog(\"bkg 1\"), { priority: \"background\" });\n  scheduler.postTask(() =&gt; myLog(\"usr-vis 1\"), { priority: \"user-visible\" });\n  scheduler.postTask(() =&gt; myLog(\"usr-blk 1\"), { priority: \"user-blocking\" });\n\n  // three more tasks, in reverse order of priority\n  scheduler.postTask(() =&gt; myLog(\"bkg 2\"), { priority: \"background\" });\n  scheduler.postTask(() =&gt; myLog(\"usr-vis 2\"), { priority: \"user-visible\" });\n  scheduler.postTask(() =&gt; myLog(\"usr-blk 2\"), { priority: \"user-blocking\" });\n\n  // Task with default priority: user-visible\n  scheduler.postTask(() =&gt; myLog(\"usr-vis 3 (default)\"));\n}\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 120px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<p>The output below shows that the tasks are executed in priority order, and then declaration order.</p><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Permanent priorities sample\" id=\"frame_permanent_priorities\" width=\"400px\" height=\"170px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"permanent_priorities\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"prose","value":{"id":"changing_task_priorities","title":"Changing task priorities","isH3":true,"content":"<p>\n  <a href=\"#task_priorities\">Task priorities</a> can also take their initial value from a <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> passed to <code>postTask()</code> in the optional second argument.\n  If set in this way, the priority of the task <a href=\"#mutable_and_immutable_task_priority\">can then be changed</a> using the controller associated with the signal.\n</p>\n<div class=\"notecard note\">\n  <p><strong>Note:</strong> Setting and changing task priorities using a signal only works when the <code>options.priority</code> argument to <code>postTask()</code> is not set, and when the <code>options.signal</code> is a <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> (and not an <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a>).</p>\n</div>\n<p>The code below first shows how to create a <a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a>, setting the initial priority of its signal to <code>user-blocking</code> in the <a href=\"/en-US/docs/Web/API/TaskController/TaskController\" title=\"TaskController()\"><code>TaskController()</code></a> constructor.</p>\n<p>\n  The code then uses <code>addEventListener()</code> to add an event listener to the controller's signal (we could alternatively use the <code>TaskSignal.onprioritychange</code> property to add an event handler).\n  The event handler uses <a href=\"/en-US/docs/Web/API/TaskPriorityChangeEvent/previousPriority\" title=\"previousPriority\"><code>previousPriority</code></a> on the event to get the original priority and <a href=\"/en-US/docs/Web/API/TaskSignal/priority\"><code>TaskSignal.priority</code></a> on the event target to get the new/current priority.\n</p>\n<p>The task is then posted, passing in the signal, and then we immediately change the priority to <code>background</code> by calling <a href=\"/en-US/docs/Web/API/TaskController/setPriority\"><code>TaskController.setPriority()</code></a> on the controller.</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 70px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>let log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>if (\"scheduler\" in this) {\n  // Create a TaskController, setting its signal priority to 'user-blocking'\n  const controller = new TaskController({ priority: \"user-blocking\" });\n\n  // Listen for 'prioritychange' events on the controller's signal.\n  controller.signal.addEventListener(\"prioritychange\", (event) =&gt; {\n    const previousPriority = event.previousPriority;\n    const newPriority = event.target.priority;\n    myLog(`Priority changed from ${previousPriority} to ${newPriority}.`);\n  });\n\n  // Post task using the controller's signal.\n  // The signal priority sets the initial priority of the task\n  scheduler.postTask(() =&gt; myLog(\"Task 1\"), { signal: controller.signal });\n\n  // Change the priority to 'background' using the controller\n  controller.setPriority(\"background\");\n}\n</code></pre></div>\n<p>\n  The output below demonstrates that the priority was successfully changed to <code>background</code> from <code>user-blocking</code>.\n  Note that in this case the priority is changed before the task is executed, but it could equally have been changed while the task was running.\n</p><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Changing task priorities sample\" id=\"frame_changing_task_priorities\" width=\"400px\" height=\"130px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"changing_task_priorities\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"prose","value":{"id":"aborting_tasks","title":"Aborting tasks","isH3":true,"content":"<p>\n  Tasks can be aborted using either <a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a> and <a href=\"/en-US/docs/Web/API/AbortController\"><code>AbortController</code></a>, in exactly the same way.\n  The only difference is that you must use <a href=\"/en-US/docs/Web/API/TaskController\"><code>TaskController</code></a> if you also want to set the task priority.\n</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 50px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>let log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<p>\n  The code below creates a controller and passes its signal to the task.\n  The task is then immediately aborted.\n  This causes the promise to be rejected with an <code>AbortError</code>, which is caught in the <code>catch</code> block and logged.\n  Note that we could also have listened for the <a href=\"/en-US/docs/Web/API/AbortSignal/abort_event\" title=\"abort\"><code>abort</code></a> event fired on the <a href=\"/en-US/docs/Web/API/TaskSignal\"><code>TaskSignal</code></a> or <a href=\"/en-US/docs/Web/API/AbortSignal\"><code>AbortSignal</code></a> and logged the abort there.\n</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>if (\"scheduler\" in this) {\n  // Declare a TaskController with default priority\n  const abortTaskController = new TaskController();\n  // Post task passing the controller's signal\n  scheduler\n    .postTask(() =&gt; myLog(\"Task executing\"), {\n      signal: abortTaskController.signal,\n    })\n    .then((taskResult) =&gt; myLog(`${taskResult}`)) // This won't run!\n    .catch((error) =&gt; myLog(`Error: ${error}`)); // Log the error\n\n  // Abort the task\n  abortTaskController.abort();\n}\n</code></pre></div>\n<p>The log below shows the aborted task.</p><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Aborting tasks sample\" id=\"frame_aborting_tasks\" width=\"400px\" height=\"100px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"aborting_tasks\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"prose","value":{"id":"delaying_tasks","title":"Delaying tasks","isH3":true,"content":"<p>\n  Tasks can be delayed by specifying an integer number of milliseconds in the <code>options.delay</code> parameter to <code>postTask()</code>.\n  This effectively adds the task to the prioritized queue on a timeout, as might be created using <a href=\"/en-US/docs/Web/API/Window/setTimeout\" title=\"setTimeout()\"><code>setTimeout()</code></a>.\n  The <code>delay</code> is the minimum amount of time before the task is added to the scheduler; it may be longer.\n</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code>&lt;textarea id=\"log\" style=\"min-height: 50px; width: 95%\"&gt;&lt;/textarea&gt;\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js hidden notranslate\"><code>let log = document.getElementById(\"log\");\nfunction myLog(text) {\n  log.textContent += `${text}\\n`;\n}\n</code></pre></div>\n<p>The code below shows two tasks added (as arrow functions) with a delay.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>if (\"scheduler\" in this) {\n  // Post task as arrow function with delay of 2 seconds\n  scheduler\n    .postTask(() =&gt; \"Task delayed by 2000ms\", { delay: 2000 })\n    .then((taskResult) =&gt; myLog(`${taskResult}`));\n  scheduler\n    .postTask(() =&gt; \"Next task should complete in about 2000ms\", { delay: 1 })\n    .then((taskResult) =&gt; myLog(`${taskResult}`));\n}\n</code></pre></div>\n<p>\n  Refresh the page.\n  Note that the second string appears in log after about 2 seconds.\n</p><div class=\"code-example\"><div class=\"example-header\"></div><iframe class=\"sample-code-frame\" title=\"Delaying tasks sample\" id=\"frame_delaying_tasks\" width=\"400px\" height=\"100px\" src=\"about:blank\" data-live-path=\"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API\" data-live-id=\"delaying_tasks\" sandbox=\"allow-same-origin allow-scripts\" loading=\"lazy\"></iframe></div>"}},{"type":"specifications","value":{"title":"Specifications","id":"specifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://wicg.github.io/scheduling-apis/#scheduler","title":"Prioritized Task Scheduling"},{"bcdSpecificationURL":"https://wicg.github.io/is-input-pending/#the-scheduling-interface","title":"Early detection of input events"}],"query":"api.Scheduler,api.Scheduling"}},{"type":"prose","value":{"id":"browser_compatibility","title":"Browser compatibility","isH3":false,"content":""}},{"type":"browser_compatibility","value":{"title":"api.Scheduler","id":"api.Scheduler","isH3":true,"query":"api.Scheduler"}},{"type":"browser_compatibility","value":{"title":"api.Scheduling","id":"api.Scheduling","isH3":true,"query":"api.Scheduling"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://medium.com/airbnb-engineering/building-a-faster-web-experience-with-the-posttask-scheduler-276b83454e91\" class=\"external\" target=\"_blank\">Building a Faster Web Experience with the postTask Scheduler</a> on the Airbnb blog (2021)</li>\n  <li><a href=\"https://web.dev/articles/optimize-long-tasks\" class=\"external\" target=\"_blank\">Optimizing long tasks</a> on web.dev (2022)</li>\n</ul>"}}],"toc":[{"text":"Concepts and usage","id":"concepts_and_usage"},{"text":"Interfaces","id":"interfaces"},{"text":"Examples","id":"examples"},{"text":"Specifications","id":"specifications"},{"text":"Browser compatibility","id":"browser_compatibility"},{"text":"See also","id":"see_also"}],"summary":"The Prioritized Task Scheduling API provides a standardized way to prioritize all tasks belonging to an application, whether they are defined in a website developer's code or in third-party libraries and frameworks.","popularity":0.0037,"modified":null,"other_translations":[],"pageType":"web-api-overview","source":{"folder":"en-us/web/api/prioritized_task_scheduling_api","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/prioritized_task_scheduling_api/index.md","last_commit_url":"https://github.com/mdn/content/commit/null","filename":"index.md"},"short_title":"Prioritized Task Scheduling API","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API","title":"Prioritized Task Scheduling API"}],"pageTitle":"Prioritized Task Scheduling API - Web APIs | MDN","noIndexing":false},"url":"/en-US/docs/Web/API/Prioritized_Task_Scheduling_API"}