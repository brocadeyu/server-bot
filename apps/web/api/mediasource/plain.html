<html><head></head><body><div class="notecard note">
  <p><strong>Note:</strong> This feature is available in <a href="/en-US/docs/Web/API/DedicatedWorkerGlobalScope">Dedicated Web Workers</a>.</p>
</div>
<p>The <strong><code>MediaSource</code></strong> interface of the <a href="/en-US/docs/Web/API/Media_Source_Extensions_API" title="Media Source Extensions API">Media Source Extensions API</a> represents a source of media data for an <a href="/en-US/docs/Web/API/HTMLMediaElement"><code>HTMLMediaElement</code></a> object. A <code>MediaSource</code> object can be attached to a <a href="/en-US/docs/Web/API/HTMLMediaElement"><code>HTMLMediaElement</code></a> to be played in the user agent.</p><svg viewBox="-1 -1 650 42" preserveAspectRatio="xMinYMin meet">
  <a style="text-decoration: none;" href="/en-US/docs/Web/API/EventTarget">
    <rect x="0" y="0" width="88" height="25" fill="#fff" stroke="#D4DDE4" stroke-width="2px"></rect>
    <text x="44" y="16" font-size="10px" fill="#4D4E53" text-anchor="middle">
      EventTarget
    </text>
  </a>
  <line x1="88" y1="14" x2="118" y2="14" stroke="#D4DDE4"></line>
  <polyline points="88,14 98,9 98,19 88,14" stroke="#D4DDE4" fill="#fff"></polyline>
  <a style="text-decoration: none;" href="/en-US/docs/Web/API/MediaSource" aria-current="page">
    <rect x="118" y="0" width="88" height="25" fill="#F4F7F8" stroke="#D4DDE4" stroke-width="2px"></rect>
    <text x="162" y="16" font-size="10px" fill="#4D4E53" text-anchor="middle">
      MediaSource
    </text>
  </a></svg>
<h2 id="constructor">Constructor</h2>
<dl>
  <dt id="mediasource"><a href="/en-US/docs/Web/API/MediaSource/MediaSource" title="MediaSource()"><code>MediaSource()</code></a></dt>
  <dd>
    <p>Constructs and returns a new <code>MediaSource</code> object with no associated source buffers.</p>
  </dd>
</dl>
<h2 id="instance_properties">Instance properties</h2>
<dl>
  <dt id="mediasource.activesourcebuffers"><a href="/en-US/docs/Web/API/MediaSource/activeSourceBuffers"><code>MediaSource.activeSourceBuffers</code></a> <span class="badge inline readonly" title="This value may not be changed.">Read only </span></dt>
  <dd>
    <p>Returns a <a href="/en-US/docs/Web/API/SourceBufferList"><code>SourceBufferList</code></a> object containing a subset of the <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> objects contained within <a href="/en-US/docs/Web/API/MediaSource/sourceBuffers"><code>MediaSource.sourceBuffers</code></a> — the list of objects providing the selected video track, enabled audio tracks, and shown/hidden text tracks.</p>
  </dd>
  <dt id="mediasource.duration"><a href="/en-US/docs/Web/API/MediaSource/duration"><code>MediaSource.duration</code></a></dt>
  <dd>
    <p>Gets and sets the duration of the current media being presented.</p>
  </dd>
  <dt id="mediasource.handle"><a href="/en-US/docs/Web/API/MediaSource/handle"><code>MediaSource.handle</code></a> <span class="badge inline readonly" title="This value may not be changed.">Read only </span></dt>
  <dd>
    <p>Inside a dedicated worker, returns a <a href="/en-US/docs/Web/API/MediaSourceHandle"><code>MediaSourceHandle</code></a> object, a proxy for the <code>MediaSource</code> that can be transferred from the worker back to the main thread and attached to a media element via its <a href="/en-US/docs/Web/API/HTMLMediaElement/srcObject"><code>HTMLMediaElement.srcObject</code></a> property.</p>
  </dd>
  <dt id="mediasource.readystate"><a href="/en-US/docs/Web/API/MediaSource/readyState"><code>MediaSource.readyState</code></a> <span class="badge inline readonly" title="This value may not be changed.">Read only </span></dt>
  <dd>
    <p>Returns an enum representing the state of the current <code>MediaSource</code>, whether it is not currently attached to a media element (<code>closed</code>), attached and ready to receive <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> objects (<code>open</code>), or attached but the stream has been ended via <a href="/en-US/docs/Web/API/MediaSource/endOfStream"><code>MediaSource.endOfStream()</code></a> (<code>ended</code>.)</p>
  </dd>
  <dt id="mediasource.sourcebuffers"><a href="/en-US/docs/Web/API/MediaSource/sourceBuffers"><code>MediaSource.sourceBuffers</code></a> <span class="badge inline readonly" title="This value may not be changed.">Read only </span></dt>
  <dd>
    <p>Returns a <a href="/en-US/docs/Web/API/SourceBufferList"><code>SourceBufferList</code></a> object containing the list of <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> objects associated with this <code>MediaSource</code>.</p>
  </dd>
</dl>
<h2 id="static_properties">Static properties</h2>
<dl>
  <dt id="mediasource.canconstructindedicatedworker"><a href="/en-US/docs/Web/API/MediaSource/canConstructInDedicatedWorker_static" title="MediaSource.canConstructInDedicatedWorker"><code>MediaSource.canConstructInDedicatedWorker</code></a> <span class="badge inline readonly" title="This value may not be changed.">Read only </span></dt>
  <dd>
    <p>A boolean; returns <code>true</code> if <code>MediaSource</code> worker support is implemented, providing a low-latency feature detection mechanism.</p>
  </dd>
</dl>
<h2 id="instance_methods">Instance methods</h2>
<p><em>Inherits methods from its parent interface, <a href="/en-US/docs/Web/API/EventTarget"><code>EventTarget</code></a>.</em></p>
<dl>
  <dt id="mediasource.addsourcebuffer"><a href="/en-US/docs/Web/API/MediaSource/addSourceBuffer"><code>MediaSource.addSourceBuffer()</code></a></dt>
  <dd>
    <p>Creates a new <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> of the given MIME type and adds it to the <a href="/en-US/docs/Web/API/MediaSource/sourceBuffers"><code>MediaSource.sourceBuffers</code></a> list.</p>
  </dd>
  <dt id="mediasource.clearliveseekablerange"><a href="/en-US/docs/Web/API/MediaSource/clearLiveSeekableRange"><code>MediaSource.clearLiveSeekableRange()</code></a></dt>
  <dd>
    <p>Clears a seekable range previously set with a call to <code>setLiveSeekableRange()</code>.</p>
  </dd>
  <dt id="mediasource.endofstream"><a href="/en-US/docs/Web/API/MediaSource/endOfStream"><code>MediaSource.endOfStream()</code></a></dt>
  <dd>
    <p>Signals the end of the stream.</p>
  </dd>
  <dt id="mediasource.removesourcebuffer"><a href="/en-US/docs/Web/API/MediaSource/removeSourceBuffer"><code>MediaSource.removeSourceBuffer()</code></a></dt>
  <dd>
    <p>Removes the given <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> from the <a href="/en-US/docs/Web/API/MediaSource/sourceBuffers"><code>MediaSource.sourceBuffers</code></a> list.</p>
  </dd>
  <dt id="mediasource.setliveseekablerange"><a href="/en-US/docs/Web/API/MediaSource/setLiveSeekableRange"><code>MediaSource.setLiveSeekableRange()</code></a></dt>
  <dd>
    <p>Sets the range that the user can seek to in the media element.</p>
  </dd>
</dl>
<h2 id="static_methods">Static methods</h2>
<dl>
  <dt id="mediasource.istypesupported"><a href="/en-US/docs/Web/API/MediaSource/isTypeSupported_static" title="MediaSource.isTypeSupported()"><code>MediaSource.isTypeSupported()</code></a></dt>
  <dd>
    <p>Returns a boolean value indicating if the given MIME type is supported by the current user agent — this is, if it can successfully create <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> objects for that MIME type.</p>
  </dd>
</dl>
<h2 id="events">Events</h2>
<dl>
  <dt id="sourceclose"><a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;MediaSource.sourceclose_event&quot;, &quot;sourceclose&quot;)}}"><code>sourceclose</code></a></dt>
  <dd>
    <p>Fired when the <code>MediaSource</code> instance is not attached to a media element anymore.</p>
  </dd>
  <dt id="sourceended"><a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;MediaSource.sourceended_event&quot;, &quot;sourceended&quot;)}}"><code>sourceended</code></a></dt>
  <dd>
    <p>Fired when the <code>MediaSource</code> instance is still attached to a media element, but <a href="/en-US/docs/Web/API/MediaSource/endOfStream" title="endOfStream()"><code>endOfStream()</code></a> has been called.</p>
  </dd>
  <dt id="sourceopen"><a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;MediaSource.sourceopen_event&quot;, &quot;sourceopen&quot;)}}"><code>sourceopen</code></a></dt>
  <dd>
    <p>Fired when the <code>MediaSource</code> instance has been opened by a media element and is ready for data to be appended to the <a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a> objects in <a href="/en-US/docs/Web/API/MediaSource/sourceBuffers" title="sourceBuffers"><code>sourceBuffers</code></a>.</p>
  </dd>
</dl>
<h2 id="examples">Examples</h2>
<h3 id="complete_basic_example">Complete basic example</h3>
<p>The following simple example loads a video with <a href="/en-US/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a>, playing it as soon as it can. This example was written by Nick Desaulniers and can be <a href="https://nickdesaulniers.github.io/netfix/demo/bufferAll.html">viewed live here</a> (you can also <a href="https://github.com/nickdesaulniers/netfix/blob/gh-pages/demo/bufferAll.html">download the source</a> for further investigation). The function <code>getMediaSource()</code>, which is not defined here, returns a <code>MediaSource</code>.</p>
<pre class="brush: js">const video = document.querySelector("video");

const assetURL = "frag_bunny.mp4";
// Need to be specific for Blink regarding codecs
// ./mp4info frag_bunny.mp4 | grep Codec
const mimeCodec = 'video/mp4; codecs="avc1.42E01E, mp4a.40.2"';
let mediaSource;

if ("MediaSource" in window &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) {
  mediaSource = getMediaSource();
  console.log(mediaSource.readyState); // closed
  video.src = URL.createObjectURL(mediaSource);
  mediaSource.addEventListener("sourceopen", sourceOpen);
} else {
  console.error("Unsupported MIME type or codec: ", mimeCodec);
}

function sourceOpen() {
  console.log(this.readyState); // open
  const sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
  fetchAB(assetURL, (buf) =&gt; {
    sourceBuffer.addEventListener("updateend", () =&gt; {
      mediaSource.endOfStream();
      video.play();
      console.log(mediaSource.readyState); // ended
    });
    sourceBuffer.appendBuffer(buf);
  });
}

function fetchAB(url, cb) {
  console.log(url);
  const xhr = new XMLHttpRequest();
  xhr.open("get", url);
  xhr.responseType = "arraybuffer";
  xhr.onload = () =&gt; {
    cb(xhr.response);
  };
  xhr.send();
}
</pre>
<h3 id="constructing_a_mediasource_in_a_dedicated_worker_and_passing_it_to_the_main_thread">Constructing a <code>MediaSource</code> in a dedicated worker and passing it to the main thread</h3>
<p>The <a href="/en-US/docs/Web/API/MediaSource/handle" title="handle"><code>handle</code></a> property can be accessed inside a dedicated worker and the resulting <a href="/en-US/docs/Web/API/MediaSourceHandle"><code>MediaSourceHandle</code></a> object is then transferred over to the thread that created the worker (in this case the main thread) via a <a href="/en-US/docs/Web/API/DedicatedWorkerGlobalScope/postMessage" title="postMessage()"><code>postMessage()</code></a> call:</p>
<pre class="brush: js">// Inside dedicated worker
let mediaSource = new MediaSource();
let handle = mediaSource.handle;
// Transfer the handle to the context that created the worker
postMessage({ arg: handle }, [handle]);

mediaSource.addEventListener("sourceopen", () =&gt; {
  // Await sourceopen on MediaSource before creating SourceBuffers
  // and populating them with fetched media — MediaSource won't
  // accept creation of SourceBuffers until it is attached to the
  // HTMLMediaElement and its readyState is "open"
});
</pre>
<p>Over in the main thread, we receive the handle via a <a href="/en-US/docs/Web/API/Worker/message_event" title="message"><code>message</code></a> event handler, attach it to a <a href="/en-US/docs/Web/HTML/Element/video"><code>&lt;video&gt;</code></a> via its <a href="/en-US/docs/Web/API/HTMLMediaElement/srcObject"><code>HTMLMediaElement.srcObject</code></a> property, and <a href="/en-US/docs/Web/API/HTMLMediaElement/play" title="play"><code>play</code></a> the video:</p>
<pre class="brush: js">worker.addEventListener("message", (msg) =&gt; {
  let mediaSourceHandle = msg.data.arg;
  video.srcObject = mediaSourceHandle;
  video.play();
});
</pre>
<div class="notecard note">
  <p><strong>Note:</strong> <a href="/en-US/docs/Web/API/MediaSourceHandle"><code>MediaSourceHandle</code></a>s cannot be successfully transferred into or via a shared worker or service worker.</p>
</div>
<h2 id="specifications">Specifications</h2><div class="bc-specs" data-bcd-query="api.MediaSource" data-spec-urls="">
  If you're able to see this, something went wrong on this page.
</div>
<h2 id="browser_compatibility">Browser compatibility</h2><div class="bc-data" data-query="api.MediaSource" data-depth="1" data-multiple="false">
  If you're able to see this, something went wrong on this page.
</div>
<h2 id="see_also">See also</h2>
<ul>
  <li><a href="/en-US/docs/Web/API/SourceBuffer"><code>SourceBuffer</code></a></li>
  <li><a href="/en-US/docs/Web/API/SourceBufferList"><code>SourceBufferList</code></a></li>
</ul>
</body></html>