{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Content Index API","mdn_url":"/en-US/docs/Web/API/Content_Index_API","locale":"en-US","native":"English (US)","browserCompat":["api.ContentIndex","api.ServiceWorkerRegistration.index"],"sidebarHTML":"<ol><li class=\"section\"><em><a href=\"/en-US/docs/Web/API/Content_Index_API\" aria-current=\"page\">Content Index API</a></em></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/ContentIndex\"><code>ContentIndex</code></a></li><li><a href=\"/en-US/docs/Web/API/ContentIndexEvent\"><code>ContentIndexEvent</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/index\"><code>ServiceWorkerRegistration.index</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/contentdelete_event\"><code>ServiceWorkerGlobalScope</code>: <code>contentdelete</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard experimental\"><p><strong>Experimental:</strong> <strong>This is an <a href=\"/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental\">experimental technology</a></strong><br>Check the <a href=\"#browser_compatibility\">Browser compatibility table</a> carefully before using this in production.</p></div><div class=\"notecard note\">\n  <p><strong>Note:</strong> This feature is available in <a href=\"/en-US/docs/Web/API/Web_Workers_API\">Web Workers</a>.</p>\n</div>\n<p>The <strong>Content Index API</strong> allows developers to register their offline enabled content with the browser.</p>"}},{"type":"prose","value":{"id":"concepts_and_usage","title":"Concepts and usage","isH3":false,"content":"<p>As it stands, offline web content is not easily discoverable by users. Content indexing allows developers to tell the browser about their specific offline content. This allows users to discover and view what is available, whilst giving developers the ability to add and manage this content. Examples could be a news website prefetching the latest articles in the background, or a content streaming app registering downloaded content.</p>\n<p>The Content Index API is an extension to <a href=\"/en-US/docs/Web/API/Service_Worker_API\">service workers</a>, which allows developers to add URLs and metadata of already cached pages, under the scope of the current service worker. The browser can then use these entries to display offline reading to a user. As a developer you can also display these entries within your application.</p>\n<p>Indexed entries do not automatically expire. It's good practice to present an interface for clearing out entries, or periodically remove older entries.</p>\n<div class=\"notecard note\">\n  <p><strong>Note:</strong> The API supports indexing URLs corresponding to HTML documents. A URL for a cached media file, for example, can't be indexed directly. Instead, you need to provide a URL for a page that displays media, and which works offline.</p>\n</div>"}},{"type":"prose","value":{"id":"interfaces","title":"Interfaces","isH3":false,"content":"<dl>\n  <dt id=\"contentindex\"><a href=\"/en-US/docs/Web/API/ContentIndex\"><code>ContentIndex</code></a> <abbr class=\"icon icon-experimental\" title=\"Experimental. Expect behavior to change in the future.\">\n    <span class=\"visually-hidden\">Experimental</span>\n</abbr></dt>\n  <dd>\n    <p>Provides functionality to register content available offline.</p>\n  </dd>\n  <dt id=\"contentindexevent\"><a href=\"/en-US/docs/Web/API/ContentIndexEvent\"><code>ContentIndexEvent</code></a> <abbr class=\"icon icon-experimental\" title=\"Experimental. Expect behavior to change in the future.\">\n    <span class=\"visually-hidden\">Experimental</span>\n</abbr></dt>\n  <dd>\n    <p>Defines the object used to represent the <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/contentdelete_event\" title=\"contentdelete\"><code>contentdelete</code></a> event.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"extensions_to_other_interfaces","title":"Extensions to other interfaces","isH3":true,"content":"<p>The following additions to the <a href=\"/en-US/docs/Web/API/ServiceWorker\"><code>ServiceWorker</code></a> have been specified in the Content Index API spec to provide an entry point for using content indexing.</p>\n<dl>\n  <dt id=\"serviceworkerregistration.index\"><a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/index\"><code>ServiceWorkerRegistration.index</code></a> <span class=\"badge inline readonly\" title=\"This value may not be changed.\">Read only </span> <abbr class=\"icon icon-experimental\" title=\"Experimental. Expect behavior to change in the future.\">\n    <span class=\"visually-hidden\">Experimental</span>\n</abbr></dt>\n  <dd>\n    <p>Returns a reference to the <a href=\"/en-US/docs/Web/API/ContentIndex\"><code>ContentIndex</code></a> interface for indexing cached pages.</p>\n  </dd>\n  <dt id=\"contentdelete\"><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/contentdelete_event\" title=\"contentdelete\"><code>contentdelete</code></a> event <abbr class=\"icon icon-experimental\" title=\"Experimental. Expect behavior to change in the future.\">\n    <span class=\"visually-hidden\">Experimental</span>\n</abbr></dt>\n  <dd>\n    <p>Fired when content is removed by the user agent.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"examples","title":"Examples","isH3":false,"content":"<p>All the following examples assume a service worker has been registered. For more information see the <a href=\"/en-US/docs/Web/API/Service_Worker_API\">Service Worker API</a>.</p>"}},{"type":"prose","value":{"id":"feature_detection_and_interface_access","title":"Feature detection and interface access","isH3":true,"content":"<p>Here we get a reference to the <a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration\"><code>ServiceWorkerRegistration</code></a>, then check for the <code>index</code> property, which gives us access to the content index interface.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// reference registration\nconst registration = await navigator.serviceWorker.ready;\n\n// feature detection\nif (\"index\" in registration) {\n  // Content Index API functionality\n  const contentIndex = registration.index;\n}\n</code></pre></div>"}},{"type":"prose","value":{"id":"adding_to_the_content_index","title":"Adding to the content index","isH3":true,"content":"<p>Here we're declaring an item in the correct format and creating an asynchronous function which uses the <a href=\"/en-US/docs/Web/API/ContentIndex/add\" title=\"add()\"><code>add()</code></a> method to register it with the content index.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// our content\nconst item = {\n  id: \"post-1\",\n  url: \"/posts/amet.html\",\n  title: \"Amet consectetur adipisicing\",\n  description:\n    \"Repellat et quia iste possimus ducimus aliquid a aut eaque nostrum.\",\n  icons: [\n    {\n      src: \"/media/dark.png\",\n      sizes: \"128x128\",\n      type: \"image/png\",\n    },\n  ],\n  category: \"article\",\n};\n\n// our asynchronous function to add indexed content\nasync function registerContent(data) {\n  const registration = await navigator.serviceWorker.ready;\n\n  // feature detect Content Index\n  if (!registration.index) {\n    return;\n  }\n\n  // register content\n  try {\n    await registration.index.add(data);\n  } catch (e) {\n    console.log(\"Failed to register content: \", e.message);\n  }\n}\n</code></pre></div>"}},{"type":"prose","value":{"id":"retrieving_items_within_the_current_index","title":"Retrieving items within the current index","isH3":true,"content":"<p>The below example shows an asynchronous function that retrieves items within the content index and iterates over each entry, building a list for the interface.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>async function createReadingList() {\n  // access our service worker registration\n  const registration = await navigator.serviceWorker.ready;\n\n  // get our index entries\n  const entries = await registration.index.getAll();\n\n  // create a containing element\n  const readingListElem = document.createElement(\"div\");\n\n  // test for entries\n  if (entries.length === 0) {\n    // if there are no entries, display a message\n    const message = document.createElement(\"p\");\n    message.innerText =\n      \"You currently have no articles saved for offline reading.\";\n\n    readingListElem.append(message);\n  } else {\n    // if entries are present, display in a list of links to the content\n    const listElem = document.createElement(\"ul\");\n\n    for (const entry of entries) {\n      const listItem = document.createElement(\"li\");\n\n      const anchorElem = document.createElement(\"a\");\n      anchorElem.innerText = entry.title;\n      anchorElem.setAttribute(\"href\", entry.url);\n\n      listElem.append(listItem);\n    }\n\n    readingListElem.append(listElem);\n  }\n}\n</code></pre></div>"}},{"type":"prose","value":{"id":"unregistering_indexed_content","title":"Unregistering indexed content","isH3":true,"content":"<p>Below is an asynchronous function, that removes an item from the content index.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>async function unregisterContent(article) {\n  // reference registration\n  const registration = await navigator.serviceWorker.ready;\n\n  // feature detect Content Index\n  if (!registration.index) return;\n\n  // unregister content from index\n  await registration.index.delete(article.id);\n}\n</code></pre></div>\n<p>All the above methods are available within the scope of the <a href=\"/en-US/docs/Web/API/ServiceWorker\">service worker</a>. They are accessible from the <a href=\"/en-US/docs/Web/API/WorkerGlobalScope/self\"><code>WorkerGlobalScope.self</code></a> property:</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>// service worker script\n\nself.registration.index.add(item);\n\nself.registration.index.delete(item.id);\n\nconst contentIndexItems = self.registration.index.getAll();\n</code></pre></div>"}},{"type":"prose","value":{"id":"the_contentdelete_event","title":"The contentdelete event","isH3":true,"content":"<p>When an item is removed from the user agent interface, a <code>contentdelete</code> event is received by the service worker.</p>\n<div class=\"code-example\"><div class=\"example-header\"><span class=\"language-name\">js</span></div><pre class=\"brush: js notranslate\"><code>self.addEventListener(\"contentdelete\", (event) =&gt; {\n  console.log(event.id);\n\n  // logs content index id, which can then be used to determine what content to delete from your cache\n});\n</code></pre></div>\n<p>The <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/contentdelete_event\" title=\"contentdelete\"><code>contentdelete</code></a> event is only fired when the deletion happens due to interaction with the browser's built-in user interface. It is not fired when the <a href=\"/en-US/docs/Web/API/ContentIndex/delete\"><code>ContentIndex.delete()</code></a> method is called.</p>"}},{"type":"specifications","value":{"title":"Specifications","id":"specifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://wicg.github.io/content-index/spec/","title":"Content Index"}],"query":"api.ContentIndex,api.ServiceWorkerRegistration.index"}},{"type":"prose","value":{"id":"browser_compatibility","title":"Browser compatibility","isH3":false,"content":""}},{"type":"browser_compatibility","value":{"title":"api.ContentIndex","id":"api.ContentIndex","isH3":true,"query":"api.ContentIndex"}},{"type":"browser_compatibility","value":{"title":"api.ServiceWorkerRegistration.index","id":"api.ServiceWorkerRegistration.index","isH3":true,"query":"api.ServiceWorkerRegistration.index"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://developer.chrome.com/docs/capabilities/web-apis/content-indexing-api\" class=\"external\" target=\"_blank\">An introductory article on the Content Index API</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Service_Worker_API\">Service Worker API, along with information about Cache and CacheStorage</a></li>\n</ul>"}}],"toc":[{"text":"Concepts and usage","id":"concepts_and_usage"},{"text":"Interfaces","id":"interfaces"},{"text":"Examples","id":"examples"},{"text":"Specifications","id":"specifications"},{"text":"Browser compatibility","id":"browser_compatibility"},{"text":"See also","id":"see_also"}],"summary":"The Content Index API allows developers to register their offline enabled content with the browser.","popularity":0.0016,"modified":"2020-10-15T22:33:23.128Z","other_translations":[],"pageType":"web-api-overview","source":{"folder":"en-us/web/api/content_index_api","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/content_index_api/index.md","last_commit_url":"https://github.com/mdn/content/commit/null","filename":"index.md"},"short_title":"Content Index API","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Content_Index_API","title":"Content Index API"}],"pageTitle":"Content Index API - Web APIs | MDN","noIndexing":false},"url":"/en-US/docs/Web/API/Content_Index_API"}