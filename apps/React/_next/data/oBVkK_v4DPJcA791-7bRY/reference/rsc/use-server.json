{"pageProps":{"toc":"[{\"url\":\"#\",\"text\":\"Overview\",\"depth\":2},{\"url\":\"#reference\",\"depth\":2,\"text\":\"Reference \"},{\"url\":\"#use-server\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" \"]},{\"url\":\"#security\",\"depth\":3,\"text\":\"Security considerations \"},{\"url\":\"#serializable-parameters-and-return-values\",\"depth\":3,\"text\":\"Serializable arguments and return values \"},{\"url\":\"#usage\",\"depth\":2,\"text\":\"Usage \"},{\"url\":\"#server-functions-in-forms\",\"depth\":3,\"text\":\"Server Functions in forms \"},{\"url\":\"#calling-a-server-function-outside-of-form\",\"depth\":3,\"text\":[\"Calling a Server Function outside of \",[\"$r\",\"code\",null,{\"children\":\"<form>\"}],\" \"]}]","content":"[[\"$r\",\"MaxWidth\",\"last\",{\"children\":[[\"$r\",\"RSC\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" is for use with \",[\"$r\",\"a\",null,{\"href\":\"/learn/start-a-new-react-project#bleeding-edge-react-frameworks\",\"children\":\"using React Server Components\"}],\".\"]}]}],\"\\n\",[\"$r\",\"Intro\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" marks server-side functions that can be called from client-side code.\"]}]}],\"\\n\",[\"$r\",\"InlineToc\",null,{}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"reference\",\"children\":\"Reference \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"use-server\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Add \",[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" at the top of an async function body to mark the function as callable by the client. We call these functions \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/server-functions\",\"children\":[\"$r\",\"em\",null,{\"children\":\"Server Functions\"}]}],\".\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2}\",\"children\":\"async function addToCart(data) {\\n  'use server';\\n  // ...\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"When calling a Server Function on the client, it will make a network request to the server that includes a serialized copy of any arguments passed. If the Server Function returns a value, that value will be serialized and returned to the client.\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Instead of individually marking functions with \",[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\", you can add the directive to the top of a file to mark all exports within that file as Server Functions that can be used anywhere, including imported in client code.\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"caveats\",\"children\":\"Caveats \"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" must be at the very beginning of their function or module; above any other code including imports (comments above directives are OK). They must be written with single or double quotes, not backticks.\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" can only be used in server-side files. The resulting Server Functions can be passed to Client Components through props. See supported \",[\"$r\",\"a\",null,{\"href\":\"#serializable-parameters-and-return-values\",\"children\":\"types for serialization\"}],\".\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"To import a Server Functions from \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-client\",\"children\":\"client code\"}],\", the directive must be used on a module level.\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Because the underlying network calls are always asynchronous, \",[\"$r\",\"code\",null,{\"children\":\"'use server'\"}],\" can only be used on async functions.\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Always treat arguments to Server Functions as untrusted input and authorize any mutations. See \",[\"$r\",\"a\",null,{\"href\":\"#security\",\"children\":\"security considerations\"}],\".\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Server Functions should be called in a \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useTransition\",\"children\":\"Transition\"}],\". Server Functions passed to \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/form#props\",\"children\":[\"$r\",\"code\",null,{\"children\":\"<form action>\"}]}],\" or \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/input#props\",\"children\":[\"$r\",\"code\",null,{\"children\":\"formAction\"}]}],\" will automatically be called in a transition.\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"Server Functions are designed for mutations that update server-side state; they are not recommended for data fetching. Accordingly, frameworks implementing Server Functions typically process one action at a time and do not have a way to cache the return value.\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"security\",\"children\":\"Security considerations \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Arguments to Server Functions are fully client-controlled. For security, always treat them as untrusted input, and make sure to validate and escape arguments as appropriate.\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"In any Server Function, make sure to validate that the logged-in user is allowed to perform that action.\"}],\"\\n\",[\"$r\",\"Wip\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":\"To prevent sending sensitive data from a Server Function, there are experimental taint APIs to prevent unique values and objects from being passed to client code.\"}],[\"$r\",\"p\",null,{\"children\":[\"See \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/experimental_taintUniqueValue\",\"children\":\"experimental_taintUniqueValue\"}],\" and \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/experimental_taintObjectReference\",\"children\":\"experimental_taintObjectReference\"}],\".\"]}]]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"serializable-parameters-and-return-values\",\"children\":\"Serializable arguments and return values \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Since client code calls the Server Function over the network, any arguments passed will need to be serializable.\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Here are supported types for Server Function arguments:\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Primitives\",\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/String\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"string\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/Number\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"number\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"bigint\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/Boolean\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"boolean\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/Undefined\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"undefined\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/Null\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"null\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"symbol\"}],\", only symbols registered in the global Symbol registry via \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":[\"$r\",\"code\",null,{\"children\":\"Symbol.for\"}]}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Iterables containing serializable values\",\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"String\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Array\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Map\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Set\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"TypedArray\"}],\" and \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"ArrayBuffer\"}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Date\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"FormData\"}],\" instances\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Plain \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"objects\"}],\": those created with \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"object initializers\"}],\", with serializable properties\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"Functions that are Server Functions\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Promises\"}]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Notably, these are not supported:\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"React elements, or \",[\"$r\",\"a\",null,{\"href\":\"/learn/writing-markup-with-jsx\",\"children\":\"JSX\"}]]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"Functions, including component functions or any other function that is not a Server Function\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Classes_in_JavaScript\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Classes\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Objects that are instances of any class (other than the built-ins mentioned) or objects with \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object#null-prototype_objects\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"a null prototype\"}]]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"Symbols not registered globally, ex. \",[\"$r\",\"code\",null,{\"children\":\"Symbol('my new symbol')\"}]]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"Events from event handlers\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Supported serializable return values are the same as \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-client#passing-props-from-server-to-client-components\",\"children\":\"serializable props\"}],\" for a boundary Client Component.\"]}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"usage\",\"children\":\"Usage \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"server-functions-in-forms\",\"children\":\"Server Functions in forms \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"The most common use case of Server Functions will be calling functions that mutate data. On the browser, the \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"HTML form element\"}],\" is the traditional approach for a user to submit a mutation. With React Server Components, React introduces first-class support for Server Functions as Actions in \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/form\",\"children\":\"forms\"}],\".\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Here is a form that allows a user to request a username.\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"formData\\\"]]\",\"children\":\"// App.js\\n\\nasync function requestUsername(formData) {\\n  'use server';\\n  const username = formData.get('username');\\n  // ...\\n}\\n\\nexport default function App() {\\n  return (\\n    <form action={requestUsername}>\\n      <input type=\\\"text\\\" name=\\\"username\\\" />\\n      <button type=\\\"submit\\\">Request</button>\\n    </form>\\n  );\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"In this example \",[\"$r\",\"code\",null,{\"children\":\"requestUsername\"}],\" is a Server Function passed to a \",[\"$r\",\"code\",null,{\"children\":\"<form>\"}],\". When a user submits this form, there is a network request to the server function \",[\"$r\",\"code\",null,{\"children\":\"requestUsername\"}],\". When calling a Server Function in a form, React will supply the form’s \",[\"$r\",\"CodeStep\",null,{\"step\":1,\"children\":[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"FormData\"}]}],\" as the first argument to the Server Function.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"By passing a Server Function to the form \",[\"$r\",\"code\",null,{\"children\":\"action\"}],\", React can \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"progressively enhance\"}],\" the form. This means that forms can be submitted before the JavaScript bundle is loaded.\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"handling-return-values\",\"children\":\"Handling return values in forms \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"In the username request form, there might be the chance that a username is not available. \",[\"$r\",\"code\",null,{\"children\":\"requestUsername\"}],\" should tell us if it fails or not.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"To update the UI based on the result of a Server Function while supporting progressive enhancement, use \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useActionState\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useActionState\"}]}],\".\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// requestUsername.js\\n'use server';\\n\\nexport default async function requestUsername(formData) {\\n  const username = formData.get('username');\\n  if (canRequest(username)) {\\n    // ...\\n    return 'successful';\\n  }\\n  return 'failed';\\n}\\n\"}]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4,8}, [[2, 2, \\\"'use client'\\\"]]\",\"children\":\"// UsernameForm.js\\n'use client';\\n\\nimport { useActionState } from 'react';\\nimport requestUsername from './requestUsername';\\n\\nfunction UsernameForm() {\\n  const [state, action] = useActionState(requestUsername, null, 'n/a');\\n\\n  return (\\n    <>\\n      <form action={action}>\\n        <input type=\\\"text\\\" name=\\\"username\\\" />\\n        <button type=\\\"submit\\\">Request</button>\\n      </form>\\n      <p>Last submission request returned: {state}</p>\\n    </>\\n  );\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Note that like most Hooks, \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" can only be called in \",[\"$r\",\"CodeStep\",null,{\"step\":1,\"children\":[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-client\",\"children\":\"client code\"}]}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"calling-a-server-function-outside-of-form\",\"children\":[\"Calling a Server Function outside of \",[\"$r\",\"code\",null,{\"children\":\"<form>\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Server Functions are exposed server endpoints and can be called anywhere in client code.\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When using a Server Function outside a \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/form\",\"children\":\"form\"}],\", call the Server Function in a \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useTransition\",\"children\":\"Transition\"}],\", which allows you to display a loading indicator, show \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useOptimistic\",\"children\":\"optimistic state updates\"}],\", and handle unexpected errors. Forms will automatically wrap Server Functions in transitions.\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{9-12}\",\"children\":\"import incrementLike from './actions';\\nimport { useState, useTransition } from 'react';\\n\\nfunction LikeButton() {\\n  const [isPending, startTransition] = useTransition();\\n  const [likeCount, setLikeCount] = useState(0);\\n\\n  const onClick = () => {\\n    startTransition(async () => {\\n      const currentCount = await incrementLike();\\n      setLikeCount(currentCount);\\n    });\\n  };\\n\\n  return (\\n    <>\\n      <p>Total Likes: {likeCount}</p>\\n      <button onClick={onClick} disabled={isPending}>Like</button>;\\n    </>\\n  );\\n}\\n\"}]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// actions.js\\n'use server';\\n\\nlet likeCount = 0;\\nexport default async function incrementLike() {\\n  likeCount++;\\n  return likeCount;\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"To read a Server Function return value, you’ll need to \",[\"$r\",\"code\",null,{\"children\":\"await\"}],\" the promise returned.\"]}]]}]]","meta":{"title":"'use server'","titleForTitleTag":"'use server' directive"},"languages":null},"__N_SSG":true}